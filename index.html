<!DOCTYPE html>
<!-- Copyright 2016 Christopher P. Nelson - All rights reserved. -->

<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>Boole&rsquo;s Errand</title>
  <link rel="stylesheet" href="circuit.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.0/raphael-min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> 
  <script src="circuit_files/jquery.mousewheel.min.js"></script>
  <script src="circuit_files/smartquotes.min.js"></script>
<script>
// Copyright 2016 Christopher P. Nelson - All rights reserved.
"use strict";function t(){Raphael.el.setAttr=function(t,e){this.node.setAttribute(t,e)};for(var t in Raphael.el)Raphael.el.hasOwnProperty(t)&&!Raphael.st.hasOwnProperty(t)&&(Raphael.st[t]=function(t){return function(){var e=arguments;return this.forEach(function(i){i[t].apply(i,e)})}}(t))}function e(){t(),this.be={},this.be.circuit=this,this.be.bdrag=new n(this.be),this.be.cdrag=Raphael("cdrag","100%","100%"),this.be.cbox=Raphael("cbox","100%","100%"),this.be.cdraw=Raphael("cdraw","100%","100%"),$("#cbox svg").attr({display:"block"}),this.be.window=$(window),this.be.div_truth=$("#truth"),this.be.div_info=$("#info"),this.be.div_infotxt=$("#infotxt"),this.be.div_info_stub=$("#info-stub"),this.be.div_controls=$("#sim-controls"),this.be.div_zoom=$("#zoom-controls"),this.be.div_main_stub=$("#main-stub"),this.be.div_cdrag=$("#cdrag"),this.be.div_cdraw=$("#cdraw"),this.be.div_cbox_container=$("#cbox_container"),this.be.div_cbox=$("#cbox"),this.be.cbox_width=this.be.div_cbox_container.outerWidth(),this.be.div_cdrag.width(this.be.cbox_width),this.be.controls_width=this.be.div_controls.outerWidth(),this.be.controls_height=this.be.div_controls.outerHeight(),this.be.zoom_width=this.be.div_zoom.outerWidth(),this.be.zoom_height=this.be.div_zoom.outerHeight(),this.be.main_stub_width=this.be.div_main_stub.outerWidth(),this.be.main_stub_height=this.be.div_main_stub.outerHeight(),this.cdraw_width=0,this.cdraw_height=0;var e=this.be.em_size=this.be.div_cbox_container.width()/8;this.be.io_spacing=10*e/8,this.be.io_handle_size=3*this.be.io_spacing/4,this.be.stub_len=5*e/8,this.be.stub_end_len=6,this.be.inv_bubble_size=4*e/8,this.be.wire_arc_radius=10*e/8,this.be.wire_speed=5*e/8,this.be.stroke_wire_fg=1*e/16,this.be.stroke_wire_bg=5*e/16,this.be.stroke_cell_fg=3*e/16,this.be.stroke_cell_bg=7*e/16,this.be.stroke_question=5*e/16,this.be.stroke_check=7*e/16,this.be.stroke_stub_end_undefined=.5*e/16,this.be.stroke_stub_end_defined=2*e/16,this.be.stroke_io_handle=1*e/16,this.be.cell_grid_x=6*this.be.io_spacing,this.be.cell_grid_y=4*this.be.io_spacing,this.be.box_spacing=this.be.io_spacing,this.be.z_cell=this.be.cdraw.path("M0,0"),this.be.z_wire=this.be.cdraw.path("M0,0"),this.be.z_io=this.be.cdraw.path("M0,0"),this.be.z_handle=this.be.cdraw.path("M0,0"),new i(this.be,"cdraw","null",0,0,"null"),this.be.sim=new a(this.be),this.be.drag=new h(this.be),this.be.bdrag.drag(this.be.div_cdraw,this,"canvas",{start:this.canvas_drag_start,move:this.canvas_drag_move,end:this.canvas_drag_end,pinch_start:this.canvas_pinch_start,pinch_move:this.canvas_pinch_move}),this.be.div_cdraw.mousewheel($.proxy(this.canvas_mousewheel,this)),$("#button-info-hide").click($.proxy(this.click_info_hide,this)),$("#button-info-unhide").click($.proxy(this.click_info_unhide,this)),$("#zoom-in").click($.proxy(this.click_zoom_in,this)),$("#zoom-out").click($.proxy(this.click_zoom_out,this)),$("#zoom-fit").click($.proxy(this.click_zoom_fit,this)),this.be.window.resize($.proxy(this.resize_event,this)),this.be.level=new r(this.be),this.begin_level()}function i(t,e,i,s,o,h,a){if(this.be=t,this.name=h,this.locked=a,this.canvas_type=e,this.canvas="cdraw"==e?this.be.cdraw:"cbox"==e?this.be.cbox:this.be.cdrag,this.type=i,this.x=s,this.y=o,this.io={},this.pending_del=!1,this.cell_fg_attr={"stroke-width":this.be.stroke_cell_fg,"stroke-linejoin":"miter",stroke:"#000",fill:"#fff"},this.cell_bg_attr={"stroke-width":this.be.stroke_cell_bg,"stroke-linejoin":"round",stroke:"cbox"==this.canvas_type?"#d0ffd0":"#eee"},this.cell_label_attr={"stroke-width":0,fill:"#000"},this.cell_fg_line_attr={"stroke-width":this.be.stroke_cell_fg,"stroke-linejoin":"miter","stroke-linecap":"round",stroke:"#000",fill:"none"},this.cell_fg_fill_attr={"stroke-width":this.be.stroke_cell_fg,"stroke-linejoin":"miter",stroke:"#fff",fill:"#fff"},this.stub_bg_attr={"stroke-width":this.be.stroke_wire_bg,stroke:"cbox"==this.canvas_type?"#d0ffd0":"#eee","stroke-linecap":"round"},this.el_s=this.canvas.set(),this.el_ns=this.canvas.set(),this.el_cell=this.canvas.set(),"function"!=typeof this["init_"+i])throw"bad cell type"+i;if(this["init_"+i](),"null"!=i){"cdrag"!=this.canvas_type&&(this.bbox=this.el_ns.getBBox(!0)),this.set_xform=this.canvas.set(this.el_cell);for(var r in this.io)this.set_xform.push(this.io[r].set_io);this.set_xform.transform("t"+this.x+","+this.y),this.bring_to_top(),this.locked?this.change_cursor("not-allowed"):this.change_cursor("grab");var n=function(t,e){return this.be.bdrag.drag($(t.node),this,"cell",{start:this.cell_drag_start,move:this.cell_drag_move,end:this.cell_drag_end}),!0};this.el_cell.forEach(n,this)}}function s(t,e,i,s,o,h,a){if(this.be=t,this.canvas=e,this.cell=i,this.name=s,this.type=o,this.x=h,this.y=a,this.w=[],"null"!=o){if(this.has_new_value=!1,this.path=["M",h,a,"H",0],this.canvas!=this.be.cdraw)return void(this.set_io=this.canvas.set());var r=this.be.io_handle_size,n={"stroke-width":this.be.stroke_io_handle};if(i.locked)this.el_target=this.canvas.circle(h,a,r,r).attr(n);else if("input"==o){var l=Math.sqrt(r*r-r*r/4);this.el_target=this.canvas.path(["M",h+r/2,a-l,"a",r,r,0,1,0,0,2*l]).attr(n)}else{var l=Math.sqrt(r*r-r*r/4);this.el_target=this.canvas.path(["M",h-r/2,a-l,"a",r,r,0,1,1,0,2*l]).attr(n)}this.el_target.setAttr("visibility","hidden"),this.el_target.setAttr("pointer-events","all"),this.be.drag.enable_drag(this);var c=15,n={"text-anchor":"middle","font-family":"Courier New, Fixed, monospace","font-size":c};this.value_y=0,this.el_value_text=this.canvas.text(this.x,this.value_y,"").attr(n),this.el_value_text.setAttr("pointer-events","none");var p={"stroke-width":0,opacity:"0"};this.el_value_text_bg=this.canvas.rect(0,0,0,0),this.el_value_text_bg.attr(p),this.el_value_text_bg.setAttr("pointer-events","none"),this.set_io=this.canvas.set(this.el_target,this.el_value_text_bg,this.el_value_text)}}function o(t,e,i,s,h){this.be=t,"output"==e.type||"input"==i.type?(this.o=e,this.i=i):(this.o=i,this.i=e),this.compute();var a={"stroke-width":this.be.stroke_wire_bg,stroke:"#eee"};this.el_bg=this.be.cdraw.path(this.path).attr(a);var a={"stroke-width":this.be.stroke_wire_fg,stroke:o.color(void 0)};if(this.el_fg=this.be.cdraw.path(this.path).attr(a),this.el_bg.setAttr("pointer-events","none"),this.el_fg.setAttr("pointer-events","none"),this.el_bg.insertBefore(this.be.z_wire),this.el_fg.insertBefore(this.be.z_wire),this.locked=h,this.o.connect(this),this.i.connect(this),this.pending_new=s,s){var a={stroke:"#eeb"};this.el_bg.attr(a)}this.pending_del=!1,this.newest_value=null,this.in_flight=[]}function h(t){this.be=t,this.io_set=[];var e=this.be.io_handle_size,i={"stroke-width":e/5,stroke:"#f00",fill:"#fff"};this.el_handle1=this.el_handle(),this.el_handle2=this.el_handle();var s=this.be.cdraw.circle(0,0,e/2,e/2).attr(i),o=this.be.cdraw.path(["M",-e/2,0,"h",e]).attr(i);this.el_fail=this.be.cdraw.set(s,o),this.el_fail.setAttr("visibility","hidden"),this.el_fail.setAttr("pointer-events","none")}function a(t){this.be=t,this.old_output_events=[],this.old_other_events=[],this.new_output_events=[],this.new_other_events=[],this.running=!1,$(document).keypress($.proxy(this.keypress,this)),$("#button-play").click($.proxy(this.click_play,this)),$("#button-pause").click($.proxy(this.click_pause,this)),this.pause_at="done",$("#pause-at-gate").click($.proxy(this.click_pause_at,this,"gate")),$("#pause-at-line").click($.proxy(this.click_pause_at,this,"line")),$("#pause-at-seq").click($.proxy(this.click_pause_at,this,"seq")),$("#pause-at-done").click($.proxy(this.click_pause_at,this,"done")),this.preferred_speed=1;var e=$("#speed-slider");this.slider_knob=$("#speed-knob")[0],this.slider_text=$("#speed-text")[0],this.slider_min_color=Raphael.getRGB("#88d"),this.slider_max_color=Raphael.getRGB("#6d6"),this.be.bdrag.drag(e,this,"speed",{start:this.speed_drag_start,move:this.speed_drag_move,end:this.speed_drag_end})}function r(t){this.be=t;try{for(var e=0;e<this.puzzle.length;e++){var i="boole."+this.puzzle[e].name+".completed";this.puzzle[e].completed=localStorage.getItem(i)}}catch(s){}var o=[];o.push('<table class="levels"><tr class="levels" id="uilevels"><td></td><td>&#9733;</td><td><b>Interface lessons only (&#9733;).</b></td></tr>');for(var e=0;e<this.puzzle.length;e++)this.puzzle[e].section&&o.push('<tr><td colspan="3"><b>',this.puzzle[e].section,"</b></td></tr>"),o.push('<tr class="levels" id="level',e,'">'),o.push('<td><svg id="complete',e,'" display="block" width="1em" height="1em" viewBox="0 0 33 33"></svg></td><td>'),this.puzzle[e].ui&&o.push("&#9733;"),o.push("</td><td>",this.puzzle[e].name,"</td></tr>");o.push("</table>"),$("#levels").html(o.join("")),$("#uilevels").click($.proxy(this.click_uilevels,this));for(var e=0;e<this.puzzle.length;e++)this.puzzle[e].completed&&this.mark_complete(e),$("#level"+e).click($.proxy(this.click_level,this,e));$("#button-main").click($.proxy(this.click_main,this)),$("#button-main2").click($.proxy(this.click_main,this))}function n(t){this.be=t,this.touchdata={},this.tapdata={}}e.prototype.begin_level=function(t){this.be.level.begin(t),this.resize(),this.fit_view(),this.update_view()},e.prototype.resize_event=function(){this.resize(!0),this.update_view()},e.prototype.resize=function(t){var e=(this.be.window_width+this.be.cbox_width)/2,i=(this.be.window_height+this.be.info_height)/2;this.be.window_width=this.be.window.width(),this.be.window_height=this.be.window.height(),this.be.div_truth.width("auto");var s=this.be.div_truth.width();this.be.div_truth.width(Math.max(s+20,8*this.be.em_size)),this.be.truth_width=this.be.div_truth.outerWidth(),this.be.div_truth.outerHeight("auto");var o=this.be.div_truth.outerHeight();if(this.be.controls_offset={top:-1,left:(this.be.truth_width+this.be.window_width-this.be.controls_width)/2},this.info_hidden){var h={top:0,left:this.be.truth_width-1};this.be.div_info_stub.offset(h),this.be.info_width=this.be.truth_width+this.be.div_info_stub.outerWidth(),this.be.info_height=this.be.div_info_stub.outerHeight()}else this.be.div_info.width(this.be.window_width-this.be.truth_width+1),this.be.info_width=1/0,this.be.info_height=this.be.div_info.outerHeight(),this.be.controls_offset.top=this.be.info_height-1;this.be.div_controls.offset(this.be.controls_offset),o<this.be.info_height&&(o=this.be.info_height,this.be.div_truth.outerHeight(o)),this.be.truth_height=o;var a=this.be.window_height-this.be.truth_height,r={top:this.be.truth_height,left:0};this.be.div_cbox_container.offset(r),this.be.div_cbox_container.height(a);var n=Math.min(1,Math.max(.5,a/this.be.box_height));if(this.be.div_cbox.width(8*this.be.em_size*n),this.be.div_cbox.height(this.be.box_height*n),this.be.cbox_width=this.be.div_cbox_container.outerWidth(),this.be.div_cdrag.width(this.be.cbox_width),t){var l=(this.be.window_width+this.be.cbox_width)/2,c=(this.be.window_height+this.be.info_height)/2,p=l-e,u=c-i,_=p/this.be.scale,d=u/this.be.scale;this.be.canvas_left-=_,this.be.canvas_top-=d}this.be.window_width>this.cdraw_width&&(this.cdraw_width=this.be.window_width+1e3,this.be.div_cdraw.width(this.cdraw_width)),this.be.window_height>this.cdraw_height&&(this.cdraw_height=this.be.window_height+1e3,this.be.div_cdraw.height(this.cdraw_height)),this.be.sim.resize_slider()},e.prototype.fit_view=function(){for(var t={},e=this.be.level.all_cells,i=0;i<e.length;i++){var s=e[i].bbox.x+e[i].x,o=e[i].bbox.y+e[i].y,h=s+e[i].bbox.width,a=o+e[i].bbox.height;void 0===t.left?(t.left=s,t.top=o,t.right=h,t.bottom=a):(s<t.left&&(t.left=s),o<t.top&&(t.top=o),h>t.right&&(t.right=h),a>t.bottom&&(t.bottom=a))}if(void 0===t.left)this.be.canvas_left=0,this.be.canvas_top=0,this.be.scale=1;else{var r=t.right-t.left+3*this.be.wire_arc_radius,n=t.bottom-t.top+3*this.be.wire_arc_radius,l=t.left-1.5*this.be.wire_arc_radius+r/2,c=t.top-2*this.be.wire_arc_radius+n/2,p=this.be.truth_width,u=this.be.window_width-p,_=this.be.info_height+this.be.div_controls.outerHeight(),d=this.be.window_height-this.be.zoom_height-_,b=u/r,v=d/n,f=Math.min(b,v),y=this.be.cbox_width,g=this.be.window_width-y,w=Math.max(_,this.be.truth_height),m=this.be.window_height-this.be.zoom_height-w,x=g/r,k=m/n,z=Math.min(x,k);if(f>z)var q=this.be.scale=Math.min(f,2),$=p+u/2,A=_+d/2;else var q=this.be.scale=Math.min(z,2),$=y+g/2,A=w+m/2;this.be.canvas_left=l-$/q,this.be.canvas_top=c-A/q}},e.prototype.cdraw_to_canvas_x=function(t){return t/this.be.scale+this.be.canvas_left},e.prototype.cdraw_to_canvas_y=function(t){return t/this.be.scale+this.be.canvas_top},e.prototype.canvas_to_cdraw_x=function(t){return(t-this.be.canvas_left)*this.be.scale},e.prototype.canvas_to_cdraw_y=function(t){return(t-this.be.canvas_top)*this.be.scale},e.prototype.update_view=function(){var t=this.cdraw_width/this.be.scale,e=this.cdraw_height/this.be.scale;this.be.cdraw.setViewBox(this.be.canvas_left,this.be.canvas_top,t,e);var i=this.be.cbox_width/this.be.scale,s=this.be.window_height/this.be.scale;this.be.cdrag.setViewBox(this.be.canvas_left,this.be.canvas_top,i,s)},e.prototype.canvas_drag_start=function(t,e){this.old_drag_x=t,this.old_drag_y=e,$(document.body).addClass("cursor-force-all-scroll")},e.prototype.canvas_drag_move=function(t,e){var i=t-this.old_drag_x,s=e-this.old_drag_y,o=i/this.be.scale,h=s/this.be.scale;this.be.canvas_left-=o,this.be.canvas_top-=h,this.update_view(),this.old_drag_x=t,this.old_drag_y=e},e.prototype.canvas_drag_end=function(){$(document.body).removeClass("cursor-force-all-scroll")},e.prototype.canvas_pinch_start=function(t,e,i,s){this.pinch_orig_distance=Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)),this.pinch_orig_scale=this.be.scale},e.prototype.canvas_pinch_move=function(t,e,i,s){var o=Math.sqrt((t-i)*(t-i)+(e-s)*(e-s)),h=this.pinch_orig_scale*(o/this.pinch_orig_distance);h>2&&(h=2),this.rescale(t,e,h)},e.prototype.canvas_mousewheel=function(t){if(!(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey)){var e=this.be.scale/Math.pow(.85,t.deltaY);this.rescale(t.pageX,t.pageY,e)}},e.prototype.rescale=function(t,e,i){i>2&&(i=2);var s=t/this.be.scale,o=e/this.be.scale,h=t/i,a=e/i;this.be.canvas_left-=h-s,this.be.canvas_top-=a-o,this.be.scale=i,this.update_view()},e.prototype.click_zoom_in=function(){this.zoom(1/.85)},e.prototype.click_zoom_out=function(){this.zoom(.85)},e.prototype.zoom=function(t){this.rescale((this.be.window_width+this.be.cbox_width)/2,(this.be.window_height+this.be.info_height)/2,this.be.scale*t)},e.prototype.click_zoom_fit=function(){this.be.circuit.fit_view(),this.be.circuit.update_view()},e.prototype.click_info_hide=function(){this.info_hidden=!0,this.be.div_info.css({display:"none"}),this.be.div_info_stub.css({display:"block"}),this.be.div_main_stub.css({display:"block"}),this.resize(),this.update_view()},e.prototype.click_info_unhide=function(){this.info_hidden=!1,this.be.div_info_stub.css({display:"none"}),this.be.div_main_stub.css({display:"none"}),this.be.div_info.css({display:"block"}),this.resize(),this.update_view()},$(function(){new e}),i.prototype.change_cursor=function(t){this.el_cell.attr({cursor:"default"}),"grab"!=t&&"grabbing"!=t||(this.el_cell.attr({cursor:"-webkit-"+t}),this.el_cell.attr({cursor:"-moz-"+t})),this.el_cell.attr({cursor:t})},i.prototype.update_quantity=function(t){if(void 0===this.quantity){var e=11,i={"text-anchor":"middle","font-family":"Verdana, Helvetica, Arial, sans-serif","font-size":e};this.qty_y=0,this.el_qty_text=this.canvas.text(this.qty_cx,this.qty_y,"").attr(i),this.el_qty_text.setAttr("pointer-events","none"),this.el_qty_text.transform("t"+this.x+","+this.y),this.push_ns(this.el_qty_text)}var i={text:"x"+t,fill:t?"#000":"#aaa"};this.el_qty_text.attr(i);var s=this.el_qty_text.getBBox(!0),o=this.qty_top,h=s.y,a=h-o;this.qty_y-=a,this.el_qty_text.attr({y:this.qty_y}),t&&!this.quantity?(this.el_s.attr({stroke:"#000"}),this.change_cursor("grab")):!t&&this.quantity&&(this.el_s.attr({stroke:"#aaa"}),this.change_cursor("not-allowed")),this.quantity=t},i.prototype.propagate_value=function(){var t="calc_"+this.type;this[t]&&this[t]()},i.prototype.reset=function(){for(var t in this.io)this.io[t].reset()},i.prototype.calc_inv=function(){this.calc_buf(!0)},i.prototype.calc_buf=function(t){var e=this.io.i.value;if(void 0!==e){var i=e;t&&(i=1-i),this.io.o.propagate_output(i)}},i.prototype.calc_nand=function(){this.calc_and(!0)},i.prototype.calc_and=function(t){var e,i=this.io.i0.value,s=this.io.i1.value;if(0===i||0===s)e=0;else{if(void 0===i||void 0===s)return;e=1}t&&(e=1-e),this.io.o.propagate_output(e)},i.prototype.calc_nor=function(){this.calc_or(!0)},i.prototype.calc_or=function(t){var e,i=this.io.i0.value,s=this.io.i1.value;if(1===i||1===s)e=1;else{if(void 0===i||void 0===s)return;e=0}t&&(e=1-e),this.io.o.propagate_output(e)},i.prototype.calc_xnor=function(){this.calc_xor(!0)},i.prototype.calc_xor=function(t){var e,i=this.io.i0.value,s=this.io.i1.value;void 0!==i&&void 0!==s&&(e=i^s,t&&(e=1-e),this.io.o.propagate_output(e))},i.prototype.calc_const=function(){this.io.o.propagate_output(0)},i.prototype.calc_input=function(){this.io.o.propagate_output(this.be.level.value(this.name))},i.prototype.calc_output=function(){var t=this.value=this.io.i.value,e=this.be.level.value(this.name);if(void 0===e||void 0===t)this.el_check.setAttr("visibility","hidden"),this.el_question.setAttr("visibility","visible");else{var i={},s=1.5*this.be.io_spacing,o=s,h=o/2,a=h+1*s/3;t===e?(i.stroke="#0c0",i.path=["M",a,0,"l",1*s/6,1*s/3,"l",2*s/6,2*-s/3]):(i.stroke="#f00",i.path=["M",a,1*-s/3,"l",2*s/3,2*s/3,"m",0,2*-s/3,"l",2*-s/3,2*s/3]),this.el_check.attr(i),this.el_check.setAttr("visibility","visible")}},i.prototype.calc_latch=function(){var t=this.io.d.value,e=this.io.e.value;1===e&&(void 0===t?this.io.q.propagate_output(void 0):this.io.q.propagate_output(t))},i.prototype.check_pending=function(){this.el_question.setAttr("visibility","visible")},i.prototype.done_check=function(){var t=this.be.level.value(this.name);return void 0===t?(this.el_question.setAttr("visibility","hidden"),!0):void 0===this.value?void 0:(this.el_question.setAttr("visibility","hidden"),this.value===this.be.level.value(this.name))},i.prototype.bring_to_top=function(){if("cdraw"==this.canvas_type){this.el_cell.insertBefore(this.be.z_cell);for(var t in this.io)this.io[t].bring_to_top()}},i.prototype.cell_drag_start=function(t,e){if(this.dragging_disallowed=this.locked||0===this.quantity,this.dragging_disallowed)return this.locked&&this.be.drag.show_fail_xy(this.x,this.y),$(document.body).addClass("cursor-force-not-allowed"),void this.be.drag.disable_hover();if($(document.body).addClass("cursor-force-grabbing"),this.be.drag.disable_hover(),this.bring_to_top(),"cbox"==this.canvas_type&&void 0!==this.quantity&&this.update_quantity(this.quantity-1),$(this.be.div_cdrag).css("z-index","99"),this.canvas==this.be.cdraw){var s=this.x,o=this.y;this.cdraw_cell=this}else{var s=this.be.circuit.cdraw_to_canvas_x(t),o=this.be.circuit.cdraw_to_canvas_y(e);this.cdraw_cell=new i(this.be,"cdraw",this.type,s,o)}this.cdrag_cell=new i(this.be,"cdrag",this.type,s,o,this.name),this.canvas_drag_offset_x=s-this.be.circuit.cdraw_to_canvas_x(t),this.canvas_drag_offset_y=o-this.be.circuit.cdraw_to_canvas_y(e),this.be.cdrag_cell=this.cdrag_cell,this.cdraw_cell.check_for_del(t,e,this.canvas==this.be.cbox),this.cdrag_cell.check_for_del(t,e,this.canvas==this.be.cbox)},i.prototype.move=function(t,e){this.x+=t,this.y+=e,this.set_xform.transform("t"+this.x+","+this.y)},i.prototype.check_for_del=function(t,e,i){var s;if(s=i&&t>=0&&t<this.be.cbox_width&&e>=this.be.truth_height&&e<this.be.window_height?"new":t<this.be.cbox_width||t>=this.be.window_width||e>=this.be.window_height||t<this.be.info_width&&e<this.be.info_height||t<this.be.truth_width&&e<this.be.truth_height||t>=this.be.controls_offset.left&&t<this.be.controls_offset.left+this.be.controls_width&&e<this.be.controls_offset.top+this.be.controls_height||t>=this.be.window_width-this.be.main_stub_width&&e<this.be.main_stub_height||t>=this.be.window_width-this.be.zoom_width&&e>=this.be.window_height-this.be.zoom_height?"del":!1,s!=this.pending_del){var o;o="new"==s?{stroke:"#aaa","stroke-dasharray":""}:"del"==s?{stroke:"#e88","stroke-dasharray":"-"}:{stroke:"#000","stroke-dasharray":""},this.el_s.attr(o);for(var h in this.io)s?this.io[h].mark_old("del"):this.io[h].restore_old();this.pending_del=s,"cdraw"==this.canvas_type&&(s?this.be.level.remove_cell(this):this.be.level.add_cell(this))}else for(var a in this.io)this.io[a].redraw()},i.prototype.cell_drag_move=function(t,e){if(!this.dragging_disallowed){var i=this.be.circuit.cdraw_to_canvas_x(t),s=this.be.circuit.cdraw_to_canvas_y(e),o=i+this.canvas_drag_offset_x-this.cdraw_cell.x,h=s+this.canvas_drag_offset_y-this.cdraw_cell.y;this.cdrag_cell.move(o,h),this.cdraw_cell.move(o,h),this.cdrag_cell.check_for_del(t,e,this.canvas==this.be.cbox),this.cdraw_cell.check_for_del(t,e,this.canvas==this.be.cbox)}},i.prototype.cell_drag_end=function(){if(this.dragging_disallowed)return this.be.drag.hide_fail(),$(document.body).removeClass("cursor-force-not-allowed"),void this.be.drag.enable_hover();if($(document.body).removeClass("cursor-force-grabbing"),this.be.drag.enable_hover(),$(this.be.div_cdrag).css("z-index","-1"),this.cdrag_cell.remove(),this.be.cdrag_cell=void 0,this.cdraw_cell.pending_del){this.cdraw_cell.remove();for(var t=this.be.level.box_cells,e=0;e<t.length;e++){var i=t[e];if(i.type==this.type){void 0!==i.quantity&&i.update_quantity(i.quantity+1);break}}}this.be.level.update_url()},i.prototype.remove=function(){var t=function(t,e){return this.be.bdrag.undrag($(t.node)),!0};this.el_cell.forEach(t,this);for(var e in this.io)this.io[e].remove();this.io=null,this.el_cell.remove()},i.prototype.init_io=function(t,e,i,o,h){var a=this.be.stub_len,r=this.be.io_spacing;t&&(h+=this.be.inv_bubble_size);for(var n=0;e>n;n++){var l=(n+.5)*r-e*r/2,c=new s(this.be,this.canvas,this,e>1?"o"+n:"o","output",h+a,l);this.io[c.name]=c}e>0&&(this.qty_cx=c.x,this.qty_top=c.y+2*this.be.stroke_wire_fg);for(var n=0;i>n;n++){var l=(n+.5)*r-i*r/2,c=new s(this.be,this.canvas,this,i>1?"i"+n:"i","input",o-a,l);this.io[c.name]=c}},i.prototype.draw_stubs=function(){var t=[];for(var e in this.io)t=t.concat(this.io[e].path);this.push_ns(this.canvas.path(t).attr(this.stub_bg_attr));for(var e in this.io)this.push_s(this.io[e].draw_stub_fg())},i.prototype.draw_inv=function(t,e,i,s){if(t){var o=this.be.inv_bubble_size/2,h=e+o,a=i?this.cell_bg_attr:this.cell_fg_attr;i?this.push_ns(this.canvas.circle(h,s||0,o).attr(a)):this.push_s(this.canvas.circle(h,s||0,o).attr(a))}},i.prototype.init_inv=function(){this.init_buf(!0)},i.prototype.init_buf=function(t){var e=1.5*this.be.io_spacing,i=Math.sqrt(3)/2*e,s=-i/2,o=i/2;this.init_io(t,1,1,s,o);var h=["M",s,-e/2,"v",e,"l",i,-e/2,"z"];this.push_ns(this.canvas.path(h).attr(this.cell_bg_attr)),this.draw_inv(t,o,!0),this.draw_stubs(),this.push_s(this.canvas.path(h).attr(this.cell_fg_attr)),this.draw_inv(t,o,!1)},i.prototype.init_nand=function(){this.init_and(!0)},i.prototype.init_and=function(t){var e=2,i=e*this.be.io_spacing,s=i/2,o=i-s,h=i,a=-h/2,r=h/2,n=-i/2;this.init_io(t,1,e,a,r);var l=["M",a,n,"v",i,"h",o,"a",s,s,0,0,0,0,-i,"h",-o,"z"];this.push_ns(this.canvas.path(l).attr(this.cell_bg_attr)),this.draw_inv(t,r,!0),this.draw_stubs(),this.push_s(this.canvas.path(l).attr(this.cell_fg_attr)),this.draw_inv(t,r,!1)},i.prototype.init_nor=function(){this.init_or(!0)},i.prototype.init_or=function(t){var e=2,i=e*this.be.io_spacing,s=i/2,o=i,h=-o/2,a=o/2,r=-i/2;this.init_io(t,1,e,h,a);var n=i,l=2*o/Math.sqrt(3),c=2.5*s,p=["M",h,r,"a",c,c,0,0,1,0,i,"a",l,n,0,0,0,o,-i/2,"a",l,n,0,0,0,-o,-i/2,"z"];this.push_ns(this.canvas.path(p).attr(this.cell_bg_attr)),this.draw_inv(t,a,!0),this.draw_stubs(),this.push_s(this.canvas.path(p).attr(this.cell_fg_attr)),this.draw_inv(t,a,!1)},i.prototype.init_xnor=function(){this.init_xor(!0)},i.prototype.init_xor=function(t){var e=2,i=e*this.be.io_spacing,s=i/2,o=i,h=-o/2,a=o/2,r=-i/2,n=o/6,l=h-n;this.init_io(t,1,e,l,a);var c=i,p=2*o/Math.sqrt(3),u=2.5*s,_=["M",h,r,"a",u,u,0,0,1,0,i,"a",p,c,0,0,0,o,-i/2,"a",p,c,0,0,0,-o,-i/2,"z","m",-n,0,"a",u,u,0,0,1,0,i],d=["M",l,r,"a",u,u,0,0,1,0,i,"h",n,"a",p,c,0,0,0,o,-i/2,"a",p,c,0,0,0,-o,-i/2,"h",-n,"z"];this.push_ns(this.canvas.path(d).attr(this.cell_bg_attr)),this.draw_inv(t,a,!0),this.draw_stubs(),this.push_ns(this.canvas.path(d).attr(this.cell_fg_fill_attr)),this.push_s(this.canvas.path(_).attr(this.cell_fg_line_attr)),this.draw_inv(t,a,!1)},i.prototype.init_input=function(){var t=1.5*this.be.io_spacing,e=t,i=-e/2,s=e/2+t/2,o=-t/2;this.init_io(!1,1,0,i,s);var h=["M",i,o,"v",t,"h",e,"L",s,0,"L",e/2,o,"z"];this.push_ns(this.canvas.path(h).attr(this.cell_bg_attr)),this.draw_stubs(),this.push_s(this.canvas.path(h).attr(this.cell_fg_attr)),this.el_text=this.canvas.text(0,0,""),this.el_text.setAttr("pointer-events","none"),this.push_ns(this.el_text)},i.prototype.init_output=function(){var t=1.5*this.be.io_spacing,e=t,i=-e/2-t/2,s=e/2,o=-t/2;this.init_io(!1,0,1,i,s);var h=["M",s,o,"v",t,"h",-e,"L",i,0,"L",-e/2,o,"z"];this.push_ns(this.canvas.path(h).attr(this.cell_bg_attr)),this.draw_stubs(),this.push_s(this.canvas.path(h).attr(this.cell_fg_attr)),this.el_text=this.canvas.text(0,0,""),this.el_text.setAttr("pointer-events","none"),this.push_ns(this.el_text);var a={"stroke-width":this.be.stroke_check,"stroke-linejoin":"round","stroke-linecap":"round"};this.el_check=this.canvas.path("M0,0").attr(a),this.el_check.setAttr("visibility","hidden"),this.el_check.setAttr("pointer-events","none"),this.push_ns(this.el_check);var r=Math.PI/6,n=Math.cos(r),l=s+1*t/3,c=l+2*t/3/2,p=3*t/6,u=p/2,_=2*t/3,d=1.5*this.be.stroke_question,b=_-d,v=1+2*n,f=b/v,a={stroke:"#888","stroke-width":this.be.stroke_question,"stroke-linejoin":"round","stroke-linecap":"round"},h=["M",c-u,-_/2+f,"a",u,f,0,1,1,3*p/4,n*f,"a",u,f,0,0,0,1*-p/4,n*f,"m",0,d,"l",0,0];this.el_question=this.canvas.path(h).attr(a),this.el_question.setAttr("visibility","hidden"),this.el_question.setAttr("pointer-events","none"),this.push_ns(this.el_question)},i.prototype.fit_input_text=function(){var t=this.name.toUpperCase(),e=this.be.level.value(this.name);if(void 0===e)var i=t+"=X";else var i=t+"="+this.be.level.value(this.name);this.el_text.attr({text:i,x:0,"font-size":"10"});var s=this.el_text.getBBox(!0),o=1.5*this.be.io_spacing,h=o,a=h+o/2,r=a/(s.width+s.height/2),n=-h/2-s.x*r+this.be.stroke_cell_fg/2;this.el_text.attr({x:n,"font-size":""+10*r})},i.prototype.fit_output_text=function(){var t=this.name.toUpperCase(),e=this.be.level.value(this.name);if(void 0===e)var i=t;else var i=t+"="+e+"?";this.el_text.attr({text:i,x:0,"font-size":"10"});var s=this.el_text.getBBox(!0);if(i.length<3){var o=s.width*(3/i.length-1);s.width+=o,s.x-=o/2}var h=1.5*this.be.io_spacing,a=h,r=a+h/2,n=r/(s.width+s.height/2),l=a/2-(s.x+s.width)*n-this.be.stroke_cell_fg/2;this.el_text.attr({x:l,"font-size":""+10*n})},i.prototype.init_const=function(){var t=1.5*this.be.io_spacing,e=t,i=-e/2,s=e/2,o=-t/2;this.init_io(!1,1,0,i,s),this.push_ns(this.canvas.rect(i,o,e,t).attr(this.cell_bg_attr)),this.draw_stubs(),this.push_s(this.canvas.rect(i,o,e,t).attr(this.cell_fg_attr))},i.prototype.init_latch=function(){var t=3*this.be.io_spacing,e=2*this.be.io_spacing,i=-e/2,o=e/2,h=-t/2;this.io.d=new s(this.be,this.canvas,this,"d","input",i-this.be.stub_len,-this.be.io_spacing),this.io.e=new s(this.be,this.canvas,this,"e","input",i-this.be.stub_len,0),this.io.q=new s(this.be,this.canvas,this,"q","output",o+this.be.stub_len,-this.be.io_spacing),this.qty_cx=this.io.q.x,this.qty_top=this.io.q.y+2*this.be.io_spacing+2*this.be.stroke_wire_fg,this.push_ns(this.canvas.rect(i,h,e,t).attr(this.cell_bg_attr)),this.draw_stubs(),this.push_s(this.canvas.rect(i,h,e,t).attr(this.cell_fg_attr));var a={"stroke-width":0,fill:"#000","text-anchor":"start"};i+=this.be.stroke_cell_fg,this.push_s(this.canvas.text(i,-this.be.io_spacing,"D").attr(a)),this.push_s(this.canvas.text(i,0,"E").attr(a)),a["text-anchor"]="end",o-=this.be.stroke_cell_fg,this.push_s(this.canvas.text(o,-this.be.io_spacing,"Q").attr(a))},i.prototype.init_null=function(){var t=new s(this.be,this.canvas,this,"null","null",0,0);this.io["null"]=t,this.be.null_io=t},i.prototype.push_s=function(t){this.el_s.push(t),this.el_cell.push(t)},i.prototype.push_ns=function(t){this.el_ns.push(t),this.el_cell.push(t)},s.prototype.draw_stub_fg=function(){var t={"stroke-width":this.be.stroke_wire_fg,stroke:o.color(void 0)},e={"stroke-width":this.be.stroke_stub_end_undefined,stroke:o.color(void 0)},i=["M",this.x,this.y-this.be.stub_end_len/2,"v",this.be.stub_end_len];return this.el_stub_end=this.canvas.path(i).attr(e),this.el_stub_end.setAttr("pointer-events","none"),this.el_stub_end.setAttr("visibility","hidden"),this.set_io.push(this.el_stub_end),this.stub=this.canvas.path(this.path).attr(t),this.stub},s.prototype.connect=function(t){if(t.locked?(this.locked=!0,this.be.drag.disable_drag(this),this.el_target.insertAfter(this.be.wire)):!this.w.length&&this.el_stub_end&&this.el_stub_end.setAttr("visibility","visible"),"output"==this.type&&this.w.length>0)for(var e=0;e<this.w.length;e++)this.w[e].reorder_z(t.el_bg,t.el_fg);this.w.push(t)},s.prototype.disconnect=function(t){for(var e=0;e<this.w.length;e++)if(t==this.w[e])return this.w.splice(e,1),void(!this.w.length&&this.el_stub_end&&this.el_stub_end.setAttr("visibility","hidden"))},s.prototype.remove=function(){for(;this.w.length;)this.w[0].remove("input"==this.type);this.canvas==this.be.cdraw&&(this.be.drag.remove_io(this),this.el_target.remove(),this.el_stub_end.remove(),this.el_value_text.remove(),this.el_value_text_bg.remove())},s.prototype.redraw=function(){for(var t=0;t<this.w.length;t++)this.w[t].redraw()},s.prototype.color_stub=function(t){var e={stroke:o.color(t)};this.pending_del||this.stub.attr(e),e["stroke-width"]=void 0===t?this.be.stroke_stub_end_undefined:this.be.stroke_stub_end_defined,this.el_stub_end.attr(e)},s.prototype.update_value=function(t){if(this.value=t,this.color_stub(t),void 0===t){t="";var e=0}else var e="1.0";this.el_value_text.attr({text:""+t});var i=this.el_value_text.getBBox(!0),s=i.x,o=this.y-2-i.height,h=this.y-2,a=i.y+i.height-1,r=a-h;this.value_y-=r,this.el_value_text.attr({y:this.value_y});var n={x:s,y:o,width:i.width,height:i.height,opacity:e};t?n.fill="#8d8":n.fill="#aaf",this.el_value_text_bg.attr(n)},s.prototype.reset=function(){if(this.update_value(void 0),this.has_new_value=!1,"input"==this.type)for(var t=0;t<this.w.length;t++)this.w[t].reset()},s.prototype.propagate_input=function(t){this.update_value(t),this.cell.propagate_value()},s.prototype.propagate_output=function(t){t!==this.value&&(this.update_value(t),this.w.length&&this.register_output())},s.prototype.register_output=function(){this.has_new_value||(this.be.sim.register_obj(this,!0),this.has_new_value=!0)},s.prototype.tick=function(t){this.has_new_value=!1;for(var e=0;e<this.w.length;e++)this.w[e].propagate_value()},s.prototype.bring_to_top=function(){this.el_value_text_bg.insertBefore(this.be.z_io),this.el_value_text.insertBefore(this.be.z_io),this.el_stub_end.insertBefore(this.be.z_io),this.el_target.insertBefore(this.be.z_io)},s.prototype.mark_old=function(t){this.pending_del=t;for(var e=0;e<this.w.length;e++)this.w[e].mark_old(t)},s.prototype.restore_old=function(){this.pending_del=!1,this.color_stub(this.value);for(var t=0;t<this.w.length;t++)this.w[t].restore_old()},o.color=function(t){return void 0===t?"#888":0===t?"#00f":1===t?"#0c0":void 0},o.prototype.measure_perf=function(t){if(this.measured||(this.measured={}),!this.measured[t]){this.measured[t]=!0;for(var e=performance.now(),i=0;1e3>i;i++)this.redraw_fg();var s=performance.now();return s-e}},o.prototype.remove=function(t){this.o.disconnect(this),this.i.disconnect(this),this.el_fg.remove(),this.el_bg.remove(),this.remove_subpaths(),this.pending_new||t||(this.i.propagate_input(void 0),this.be.level.circuit_changed()),this.dead=!0},o.prototype.mark_old=function(t){this.pending_del=t,"del"==t&&this.remove_subpaths(),this.redraw_fg()},o.prototype.restore_old=function(){this.pending_del=!1,
this.redraw_fg()},o.prototype.propagate_value=function(){if(!this.pending_new)if(this.in_flight.length)this.newest_value=this.o.value;else{this.be.sim.register_obj(this,!1);var t={age:0,value:this.o.value};this.in_flight.push(t)}},o.prototype.reset=function(){this.newest_value=null,this.remove_subpaths(),this.in_flight=[],this.redraw_fg()},o.prototype.tick=function(t){if(!this.dead){if(this.in_flight.length){var e=this.in_flight[this.in_flight.length-1];this.newest_value===e.value&&(this.newest_value=null)}else this.newest_value===this.i.value&&(this.newest_value=null);for(var i=0;i<this.in_flight.length;i++){var e=this.in_flight[i];e.age+=this.be.wire_speed*t/this.path_length,e.age>=1&&(e.el_subpath&&e.el_subpath.remove(),this.i.propagate_input(e.value),this.in_flight.splice(0,1),i--)}if(this.redraw_fg(),null!==this.newest_value){var e={age:0,value:this.newest_value};this.in_flight.push(e),this.newest_value=null}this.in_flight.length&&this.be.sim.register_obj(this,!1)}},o.prototype.reorder_z=function(t,e){this.el_bg.insertBefore(t),this.el_fg.insertBefore(e);for(var i=this.in_flight.length-1;i>=0;i--)this.in_flight[i].el_subpath&&this.in_flight[i].el_subpath.insertBefore(e)},o.prototype.get_subpath=function(t,e){function i(t){var e,i;if(c>t){var s=t/l.r,o=l.cwa?1:-1;return e=l.r*Math.sin(s),i=l.r*(1-Math.cos(s))*o,[h+e,a+i]}if(p>t){var _=t-c;return e=(l.xb-l.xa)*(_/l.seg_len),i=(l.yb-l.ya)*(_/l.seg_len),[l.xa+e,l.ya+i]}var s=(u-t)/l.r,d=l.cwb?1:-1;return e=-l.r*Math.sin(s),i=l.r*(1-Math.cos(s))*d,[r+e,n+i]}var s,o,h=this.o.cell.x+this.o.x,a=this.o.cell.y+this.o.y,r=this.i.cell.x+this.i.x,n=this.i.cell.y+this.i.y,l=this.aw,c=l.angle_a*l.r,p=c+l.seg_len,u=this.path_length,_=c>t?0:p>t?1:2,d=c>e?0:p>e?1:2,b=["M"].concat(i(t));return 0==_?0==d?(s=(e-t)/l.r>Math.PI?1:0,b=b.concat("A",l.r,l.r,0,s,l.cwa,i(e))):(s=(c-t)/l.r>Math.PI?1:0,b=b.concat("A",l.r,l.r,0,s,l.cwa,l.xa,l.ya),1==d?b=b.concat("L",i(e)):(o=(e-p)/l.r>Math.PI?1:0,b=b.concat("L",l.xb,l.yb,"A",l.r,l.r,0,o,l.cwb,i(e)))):1==_?1==d?b=b.concat("L",i(e)):(o=(e-p)/l.r>Math.PI?1:0,b=b.concat("L",l.xb,l.yb,"A",l.r,l.r,0,o,l.cwb,i(e))):(o=(e-t)/l.r>Math.PI?1:0,b=b.concat("A",l.r,l.r,0,o,l.cwb,i(e))),b},o.prototype.arcwire=function(t,e,i,s){var o,h,a,r,n,l,c,p,u,_,d,b,v,f,y=t+i,g=e+s,w=this.be.wire_arc_radius,m=(y-t)/w,x=(g-e)/w;if(m>0||x>=4||-4>=x){var k;x>=0?(k=1,d=1,b=0):(k=-1,d=0,b=1,x=-x),v=0,f=0,m>0&&4==x?(o=2/m,h=2*Math.atan(o)):0>=m&&4==x?h=Math.PI:m>2||m*m+(x-4)*x>0?(o=(Math.sqrt(m*m+(x-4)*x)-m)/(x-4),h=2*Math.atan(o)):(o=x/m,h=2*Math.atan(o),w=w*m*(o*o+1)/(4*o)),n=w*Math.sin(h),l=w*(1-Math.cos(h))*k,u=y-n,_=g-l,a=r=h}else{d=0,b=0,4>m*m+x*x&&(w*=Math.sqrt(m*m+x*x)/2);var z=m/x;x>=0?(v=1,f=0,o=Math.sqrt(z*z+1)-z,h=0==x?Math.PI:2*Math.atan(o),a=2*Math.PI-h,r=h):(v=0,f=1,o=Math.sqrt(z*z+1)+z,h=-2*Math.atan(o),a=-h,r=2*Math.PI-a),n=-w*Math.sin(h),l=-w*(1-Math.cos(h)),u=y+n,_=g+l}c=t+n,p=e+l,this.path=["M",t,e,"A",w,w,0,v,d,c,p,"L",u,_,"A",w,w,0,f,b,y,g];var q=Math.sqrt((u-c)*(u-c)+(_-p)*(_-p));this.path_length=a*w+q+r*w,this.aw={r:w,angle_a:a,cwa:d,la:v,xa:c,ya:p,seg_len:q,xb:u,yb:_,angle_b:r,cwb:b,lb:f}},o.prototype.compute=function(){var t=this.o.cell.x+this.o.x,e=this.o.cell.y+this.o.y,i=this.i.cell.x+this.i.x,s=this.i.cell.y+this.i.y;this.arcwire(t,e,i-t,s-e)},o.prototype.redraw_fg=function(){if("del"==this.pending_del){var t={path:this.path,stroke:"#e88","stroke-dasharray":"-",opacity:"1.0"};return void this.el_fg.attr(t)}for(var e=this.i.value,i=this.el_fg,s=this.path_length,h=0;h<this.in_flight.length;h++){var a=this.in_flight[h],r=a.age*this.path_length,n=this.get_subpath(r,s);if(i.attr({path:n,stroke:o.color(e)}),!a.el_subpath){var t={"stroke-width":this.be.stroke_wire_fg};a.el_subpath=this.be.cdraw.path("M0,0").attr(t),a.el_subpath.insertAfter(i)}e=a.value,i=a.el_subpath,s=r}if(0!=s){var n;n=s>=this.path_length?this.path:this.get_subpath(0,s);var t={path:n,stroke:o.color(e),"stroke-dasharray":"",opacity:"null"==this.pending_del?"0.4":"1.0"};i.attr(t)}},o.prototype.redraw=function(){this.compute(),this.el_bg.attr({path:this.path}),this.el_fg.attr({path:this.path}),this.redraw_fg()},o.prototype.remove_subpaths=function(){for(var t=0;t<this.in_flight.length;t++){var e=this.in_flight[t];e.el_subpath&&(e.el_subpath.remove(),e.el_subpath=void 0)}},h.prototype.el_handle=function(){var t={"stroke-width":this.be.stroke_io_handle,stroke:"#f80",fill:"#ff0",opacity:"0.80"},e=this.be.io_handle_size,i=this.be.cdraw.circle(0,0,e/2,e/2).attr(t);return i.setAttr("visibility","hidden"),i.setAttr("pointer-events","none"),i},h.prototype.reset=function(){this.io_set=[]},h.prototype.remove_null_wire=function(){this.null_wire&&(this.null_wire.remove(),this.null_wire=null)},h.prototype.gen_old_wires=function(t){var e=this.new_io==this.be.null_io?"null":"del";this.old_wires=this.old_wires.concat(t.w.slice(0));for(var i=0;i<this.old_wires.length;i++)this.old_wires[i].mark_old(e)},h.prototype.restore_old_wires=function(){for(var t=0;t<this.old_wires.length;t++)this.old_wires[t].restore_old();this.old_wires=[]},h.prototype.remove_new_wires=function(){for(var t=0;t<this.new_wires.length;t++)this.new_wires[t].remove();this.new_wires=[]},h.prototype.commit_new_wires=function(){for(var t={stroke:"#eee"},e=0;e<this.new_wires.length;e++)this.new_wires[e].el_bg.attr(t),this.new_wires[e].pending_new=!1,this.new_wires[e].o.register_output();this.new_wires=[]},h.prototype.drag_start=function(t,e){var i=this.closest_io(t,e);this.show_handle(this.el_handle1,i),$(document.body).addClass("cursor-force-default"),this.snap_io=i,this.orig_io=i,this.orig_empty=0==i.w.length,this.new_io=this.be.null_io,this.new_wires=[],this.old_wires=[],this.null_wire=null,this.disable_hover()},h.prototype.drag_move=function(t,e){var i=this.closest_io(t,e,!0);i!=this.snap_io&&(this.snap_io&&this.snap_end(t,e,this.snap_io),i?(this.snap_io=i,this.update_new_io(t,e,i)):(this.snap_io=void 0,this.update_new_io(t,e,this.be.null_io))),this.update_free_drag(t,e)},h.prototype.drag_end=function(){if(this.hide_handle(this.el_handle1),this.snap_io&&this.snap_end(),this.new_io==this.be.null_io)this.restore_old_wires();else{for(var t=0;t<this.old_wires.length;t++)this.old_wires[t].remove();this.old_wires=[]}this.commit_new_wires(),this.remove_null_wire(),this.orig_io=null,this.new_io=null,this.be.level.update_url(),$(document.body).removeClass("cursor-force-default"),this.enable_hover()},h.prototype.mouse_double_click=function(t){this.dblclick(t.pageX,t.pageY)},h.prototype.dblclick=function(t,e){for(var i=this.closest_io(t,e);i.w.length>0;)i.w[0].remove(),this.be.level.update_url()},h.prototype.hover_start=function(t){var e=t.pageX,i=t.pageY,s=this.closest_io(e,i);s.locked||(this.pending_hover_io=s,this.no_hover||this.show_handle(this.el_handle1,s),$(document).on("mousemove.boolehover",$.proxy(this.hover_move,this)))},h.prototype.hover_move=function(t){var e=t.pageX,i=t.pageY,s=this.closest_io(e,i);s.locked||(s==this.pending_hover_io||this.no_hover||this.show_handle(this.el_handle1,s),this.pending_hover_io=s)},h.prototype.hover_end=function(){this.no_hover||this.hide_handle(this.el_handle1,this.pending_hover_io),this.pending_hover_io=void 0,$(document).off("mousemove.boolehover")},h.prototype.closest_io=function(t,e,i){for(var s=null,o=1/0,h=i?this.be.io_handle_size*this.be.io_handle_size:1/0,a=this.be.circuit.cdraw_to_canvas_x(t),r=this.be.circuit.cdraw_to_canvas_y(e),n=0;n<this.io_set.length;n++){var l=this.io_set[n],c=l.x+l.cell.x-a,p=l.y+l.cell.y-r,u=c*c+p*p;if(h>u&&(o>u||!l.locked&&s.locked)){o=u;var s=l}}return s},h.prototype.enable_drag=function(t){t.el_target.dblclick($.proxy(this.mouse_double_click,this)),this.be.bdrag.drag($(t.el_target.node),this,"cell",{start:this.drag_start,move:this.drag_move,end:this.drag_end,dblclick:this.dblclick}),t.el_target.hover($.proxy(this.hover_start,this),$.proxy(this.hover_end,this)),this.io_set.push(t)},h.prototype.disable_drag=function(t){var e=$(t.el_target.node);this.be.bdrag.undrag(e),t.el_target.undblclick(),t.el_target.unhover(),t.el_target.attr({cursor:"not-allowed"}),this.be.bdrag.drag(e,this,"cell",{start:this.drag_locked_start,end:this.drag_locked_end})},h.prototype.remove_io=function(t){this.be.bdrag.undrag($(t.el_target.node)),t.el_target.undblclick(),t.el_target.unhover();for(var e=0;e<this.io_set.length;e++)if(this.io_set[e]==t){this.io_set.splice(e,1);break}},h.prototype.disable_hover=function(){this.no_hover=!0},h.prototype.enable_hover=function(){this.no_hover=!1,this.pending_hover_io&&this.show_handle(this.el_handle1,this.pending_hover_io)},h.prototype.snap_end=function(){this.hide_handle(this.el_handle2),this.hide_fail(),this.snap_io=void 0,this.fail_io=void 0},h.prototype.show_handle=function(t,e){t.transform("t"+(e.cell.x+e.x)+","+(e.cell.y+e.y)),t.setAttr("visibility","visible")},h.prototype.hide_handle=function(t){t.setAttr("visibility","hidden")},h.prototype.show_fail=function(t){this.show_fail_xy(t.cell.x+t.x,t.cell.y+t.y)},h.prototype.show_fail_xy=function(t,e){this.el_fail.transform("t"+t+","+e+"r45"),this.el_fail.setAttr("visibility","visible")},h.prototype.hide_fail=function(){this.el_fail.setAttr("visibility","hidden")},h.prototype.connect_o_to_i=function(t,e){e.w.length>0&&e.w[0].o==t?this.gen_old_wires(e):(this.gen_old_wires(e),this.new_wires.push(new o(this.be,t,e,!0)))},h.prototype.update_new_io=function(t,e,i){if(i==this.orig_io?i=this.be.null_io:this.orig_empty&&this.orig_io.type==i.type||i.locked?(this.show_fail(i),this.fail_io=!0,i=this.be.null_io):i!=this.orig_io&&i!=this.be.null_io&&this.show_handle(this.el_handle2,i),i!=this.new_io)if(this.restore_old_wires(),this.remove_new_wires(),this.remove_null_wire(),this.new_io=i,"null"==i.type)"input"==this.orig_io.type&&this.gen_old_wires(this.orig_io),this.update_free_drag(t,e);else if("output"==this.orig_io.type&&"input"==i.type)this.connect_o_to_i(this.orig_io,i);else if("output"==this.orig_io.type&&"output"==i.type){this.gen_old_wires(this.orig_io);for(var s=0;s<this.old_wires.length;s++)this.new_wires.push(new o(this.be,this.old_wires[s].i,this.new_io,!0))}else"input"==this.orig_io.type&&"output"==i.type?this.connect_o_to_i(i,this.orig_io):"input"==this.orig_io.type&&"input"==i.type?(this.gen_old_wires(this.orig_io),i.w.length&&i.w[0].o==this.orig_io.w[0].o||(this.gen_old_wires(i),this.new_wires.push(new o(this.be,this.orig_io.w[0].o,i,!0)))):this.update_new_io(t,e,this.be.null_io)},h.prototype.update_free_drag=function(t,e){if(this.new_io==this.be.null_io)if(this.be.null_io.x=this.be.circuit.cdraw_to_canvas_x(t),this.be.null_io.y=this.be.circuit.cdraw_to_canvas_y(e),this.null_wire)this.null_wire.redraw();else{if("input"!=this.orig_io.type||this.orig_empty)var i=this.orig_io;else var i=this.orig_io.w[0].o;this.null_wire=new o(this.be,i,this.be.null_io,!0)}},h.prototype.drag_locked_start=function(t,e){var i=this.closest_locked_io(t,e);this.show_fail(i),$(document.body).addClass("cursor-force-not-allowed"),this.disable_hover()},h.prototype.drag_locked_end=function(){this.hide_fail(),$(document.body).removeClass("cursor-force-not-allowed"),this.enable_hover()},h.prototype.closest_locked_io=function(t,e){for(var i=1/0,s=this.be.circuit.cdraw_to_canvas_x(t),o=this.be.circuit.cdraw_to_canvas_y(e),h=0;h<this.io_set.length;h++){var a=this.io_set[h];if(a.locked){var r=a.x+a.cell.x-s,n=a.y+a.cell.y-o,l=r*r+n*n;if(i>l){i=l;var c=a}}}return c},a.prototype.resize_slider=function(){var t=$("#speed-slider"),e=t.offset();this.slider_left=e.left,this.slider_width=t.width()},a.prototype.click_play=function(){this.running||($("#button-play").hide(),$("#button-pause").show(),this.running=!0,this.is_still_paused=!1,this.start(),this.be.level.click_play(),this.no_new_events()&&this.be.level.done(!0))},a.prototype.click_pause=function(){$("#button-pause").hide(),$("#button-play").show(),this.running=!1,this.pause()},a.prototype.start=function(){this.delay_timer&&(clearTimeout(this.delay_timer),this.delay_timer=void 0),this.timer||(this.be.level.start(),this.running&&(this.timer=setInterval($.proxy(this.tick,this),50)))},a.prototype.pause=function(){this.timer&&(clearInterval(this.timer),this.timer=void 0),this.delay_timer&&(clearTimeout(this.delay_timer),this.delay_timer=void 0)},a.prototype.paused=function(){return!this.running},a.prototype.no_new_events=function(){return!this.new_other_events.length&&!this.new_output_events.length},a.prototype.register_obj=function(t,e){this.no_new_events()&&this.start(),e?this.new_output_events.push(t):this.new_other_events.push(t)},a.prototype.tick=function(){"gate"==this.pause_at&&this.new_other_events.length?this.old_output_events=[]:(this.old_output_events=this.new_output_events,this.new_output_events=[]),this.old_other_events=this.new_other_events,this.new_other_events=[];for(var t=0;t<this.old_output_events.length;t++)this.old_output_events[t].tick(this.speed);for(var t=0;t<this.old_other_events.length;t++)this.old_other_events[t].tick(this.speed);this.no_new_events()?(this.pause(),this.be.level.done(!1)):"gate"!=this.pause_at||this.new_other_events.length||this.click_pause()},a.prototype.reset=function(){this.pause(),this.new_output_events=[],this.new_other_events=[]},a.prototype.pass_row=function(t,e,i){e?t():"done"==this.pause_at||"seq"==this.pause_at&&"seq"!=i?this.delay_timer=setTimeout(t,1e3/this.speed):this.click_pause()},a.prototype.pass_delay_complete=function(t){this.delay_timer=void 0,this.be.level.select_row(t)},a.prototype.keypress=function(t){var e=String.fromCharCode(t.which),i=t.ctrlKey||t.altKey||t.metaKey;"-"!=e||i?"="!=e&&"+"!=e||i?"f"!=e&&"F"!=e||i||this.be.circuit.click_zoom_fit():this.be.circuit.click_zoom_in():this.be.circuit.click_zoom_out()},a.prototype.speed_drag_start=function(t,e){this.speed_drag_move(t,e)},a.prototype.speed_drag_move=function(t,e){t=350*(t-this.slider_left)/this.slider_width;var i=30,s=110,o=260;if(t>=o)t=o,this.speed=1/0;else if(t>s+15){var h=4*(t-s)/(o-s);this.speed=Math.pow(2,h)}else if(t>s-15)t=s,this.speed=1;else{i>t&&(t=i);var h=-2+2*(t-i)/(s-i);this.speed=Math.pow(2,h)}this.slider_knob.setAttribute("cx",t);var a=(t-i)/(o-i),r=this.slider_min_color,n=this.slider_max_color,l=r.r+(n.r-r.r)*a,c=r.g+(n.g-r.g)*a,p=r.b+(n.b-r.b)*a;this.slider_text.setAttribute("fill",Raphael.rgb(l,c,p)),this.preferred_speed=this.speed},a.prototype.speed_drag_end=function(){},a.prototype.click_pause_at=function(t){$("#pause-at-"+this.pause_at).removeClass("pause-at-selected"),this.pause_at=t,$("#pause-at-"+this.pause_at).addClass("pause-at-selected")},a.prototype.begin_level=function(t,e){t?($("#pause-at")[0].setAttribute("display","none"),$("#speed-slider")[0].setAttribute("display","none"),this.speed=1):($("#pause-at")[0].setAttribute("display",""),$("#speed-slider")[0].setAttribute("display",""),this.speed=this.preferred_speed,e?$("#pause-at-seq").removeClass("pause-at-hidden"):$("#pause-at-seq").addClass("pause-at-hidden")),this.click_pause_at("done")},r.prototype.mark_complete=function(t){var e="#complete"+t;$(e).html('<path d="M7.5,16.5l6,12l12,-24" class="checkmark"/>')},r.prototype.begin=function(t){var e=void 0;if(void 0===t){var s=decodeURI(window.location.hash.substring(1));if(""!=s){var h=s.split("?",2),a=h[0];2==h.length&&(e=h[1]);for(var r=0;r<this.puzzle.length;r++)if(this.puzzle[r].name==a){t=r;break}}else t=this.next_level(0)}t||(t=0),this.level_num=t;var n=this.level=this.puzzle[t];void 0===n.hide?n.hide=new Set:Array.isArray(n.hide)&&(n.hide=new Set(n.hide)),this.box_cells=[],this.be.box_height=this.be.box_spacing,void 0===n.avail&&(n.avail=["inv","and","nand","or","nor","xor","xnor"]);for(var r=0;r<n.avail.length;r++){var l=n.avail[r];"string"==typeof l?this.add_box_cell(l):this.box_cells[this.box_cells.length-1].update_quantity(l)}this.be.cbox.setViewBox(0,0,8*this.be.em_size,this.be.box_height),this.named_cells={},this.all_cells=[],this.be.div_infotxt.html(n.intro||""),smartquotes(this.be.div_infotxt[0]),this.input_names=[],this.output_names=[];for(var c in n.cells){var p=n.cells[c];"input"==p.type&&this.input_names.push(c),"output"==p.type&&this.output_names.push(c)}this.init_table();for(var c in n.cells){var p=n.cells[c],u=new i(this.be,"cdraw",p.type,p.x/20*this.be.io_spacing,p.y/20*this.be.io_spacing,c,!0);this.named_cells[c]=u,this.add_cell(u)}for(var c in n.cells){var _=n.cells[c].io;if(_)for(var r=0;r<_.length;r++){var d=_[r][0],b=_[r][1],v=_[r][2];new o(this.be,this.named_cells[c].io[d],this.named_cells[b].io[v],!1,!0)}}e?this.decode_save(e):window.location.hash=encodeURI(n.name),this.cur_seq=0,this.cur_line=0,this.select_seq(0),this.be.sim.begin_level(n.hide.has("speed"),this.sequenced)},r.prototype.init_table=function(){var t=this.level;this.sequenced=!1,this.row_result=[];var e=[];t.hide.has("truth")?e.push('<table style="display: none;"><tr>'):e.push('<table class="truth"><tr>'),this.table_header(e,this.input_names),this.table_header(e,this.output_names),e.push('<th class="check"></th></tr>');var i=0;this.row_seq=[],this.row_line=[];for(var s=0;s<t.truth.length;s++){Array.isArray(t.truth[s])?t.truth[s].length>1&&(this.sequenced=!0):t.truth[s]=[t.truth[s]];var o=t.truth[s];o.first_row=i;for(var h=0;h<o.length;h++){var a=h==o.length-1;e.push('<tr class="truthbody" id="row',i,'">'),this.table_line(e,this.input_names,o[h],a),this.table_line(e,this.output_names,o[h],a),e.push('<td class="check"><svg id="check',i,'" display="block" width="1em" height="1em" viewBox="0 0 33 33"></svg></td></tr>'),this.row_result.push(void 0),this.row_seq.push(s),this.row_line.push(h),i++}}e.push("</table>"),$("#truthtable").html(e.join(""));for(var s=0;i>s;s++){var r=$("#row"+s);r.hover($.proxy(this.row_enter,this,s),$.proxy(this.row_leave,this,s)),r.click($.proxy(this.row_click,this,s)),r.dblclick($.proxy(this.row_dblclick,this,s)),this.be.bdrag.drag(r,this,"truth",{dblclick:this.row_dblclick})}},r.prototype.table_header=function(t,e){for(var i=0;i<e.length;i++)t.push("<th"),this.push_padding(t,i,e.length,!0),t.push(">",e[i].toUpperCase(),"</th>")},r.prototype.table_line=function(t,e,i,s){for(var o=0;o<e.length;o++)t.push("<td"),this.push_padding(t,o,e.length,s),t.push(">"),void 0!==i[e[o]]&&t.push(i[e[o]]),t.push("</td>")},r.prototype.push_padding=function(t,e,i,s){var o=s?" tdb":"";0==e?i-1>e?t.push(' class="tdl',o,'"'):t.push(' class="tdlr',o,'"'):e==i-1?t.push(' class="tdr',o,'"'):s&&t.push(' class="tdb"')},r.prototype.row_enter=function(t,e){this.hover_row=t;var i=this.cur_row();if(t===this.row_allows_simple_click)t!=i&&$("#row"+t).css({"background-color":"#ddd"});else for(var s=this.row_seq[t],o=0;o<this.level.truth[s].length;o++){var h=this.level.truth[s].first_row+o;h!=i&&$("#row"+h).css({"background-color":"#ddd"})}},r.prototype.row_leave=function(t,e){this.hover_row=void 0;for(var i=this.cur_row(),s=0;s<this.row_result.length;s++)s!=i&&$("#row"+s).css({"background-color":""})},r.prototype.update_hover=function(){if(void 0!==this.hover_row){var t=this.hover_row;this.row_leave(t),this.row_enter(t)}},r.prototype.row_click=function(t,e){var i=this.cur_row();t===this.row_allows_simple_click?t==i+1&&this.next_line():(this.reset_sim(),this.select_seq(this.row_seq[t]))},r.prototype.row_dblclick=function(t,e){this.be.sim.click_play()},r.prototype.cur_row=function(){return this.level.truth[this.cur_seq].first_row+this.cur_line},r.prototype.select_row=function(t){$("#row"+this.cur_row()).css({"background-color":""}),$("#row"+t).css({"background-color":"#ff8"}),this.cur_seq=this.row_seq[t],this.cur_line=this.row_line[t],this.update_hover(),this.update_pins()},r.prototype.select_seq=function(t){this.reset_sim(),this.select_row(this.level.truth[t].first_row)},r.prototype.next_line=function(){this.start(),this.select_row(this.cur_row()+1)},r.prototype.update_pins=function(){for(var t=0;t<this.input_names.length;t++){var e=this.named_cells[this.input_names[t]];e.propagate_value(),e.fit_input_text()}for(var t=0;t<this.output_names.length;t++){var e=this.named_cells[this.output_names[t]];e.calc_output(),e.fit_output_text()}},r.prototype.reset_sim=function(){this.row_allows_simple_click=!1,this.update_hover(),this.be.sim.reset();for(var t=0;t<this.all_cells.length;t++)this.all_cells[t].reset()},r.prototype.add_box_cell=function(t){var e=new i(this.be,"cbox",t,0,0);this.box_cells.push(e);var s=e.bbox,o=4*this.be.em_size-s.x-s.width/2,h=this.be.box_height-s.y;e.move(o,h),this.be.box_height+=s.height+this.be.box_spacing},r.prototype.value=function(t){var e=this.puzzle[this.level_num].truth;return e[this.cur_seq][this.cur_line][t]},r.prototype.add_cell=function(t){this.all_cells.push(t)},r.prototype.remove_cell=function(t){for(var e=0;e<this.all_cells.length;e++)if(t==this.all_cells[e])return void this.all_cells.splice(e,1)},r.prototype.update_url=function(){for(var t=[this.level.name],e=0;e<this.all_cells.length&&this.all_cells[e].locked;e++);t.push("?1s",e);for(var e=0;e<this.all_cells.length;e++){var i=!1,s=this.all_cells[e];s.locked||(t.push(";",Math.round(s.x/this.be.io_spacing*20),",",s.type,",",Math.round(s.y/this.be.io_spacing*20)),i=!0);for(var o in s.io){var h=s.io[o];if("output"==h.type)for(var a=0;a<h.w.length;a++){var r=h.w[a];r.locked||(i?t.push("+"):t.push("-",e,","),t.push(o,",",this.all_cells.indexOf(r.i.cell),",",r.i.name))}}}var n=t.join("");window.location.hash=encodeURI(n)},r.prototype.decode_save=function(t){try{var e,s=/^1s([0-9]+)/,h=/^;(-?[0-9]+),([a-z][a-z0-9]*),(-?[0-9]+)/,a=/^\+([a-z][a-z0-9]*),([0-9]+),([a-z][a-z0-9]*)/,r=/^-([0-9]+),([a-z][a-z0-9]*),([0-9]+),([a-z][a-z0-9]*)/,n=[];if(!(e=s.exec(t)))throw"bad version/skip string";var l=Number(e[1]);if(l!=this.all_cells.length)throw"wrong skip";for(t=t.substring(e[0].length);""!=t;)if(e=h.exec(t)){var c=Number(e[1]),p=e[2],u=Number(e[3]);if("io"==p||"null"==p)throw"bad cell type: "+p;for(var _=0;_<this.box_cells.length;_++){var d=this.box_cells[_];if(d.type==p){if(void 0!==d.quantity){if(0==d.quantity)throw"exhausted cell type: "+p;d.update_quantity(d.quantity-1)}break}}if(_==this.box_cells.length)throw"disallowed cell type: "+p;for(this.add_cell(new i(this.be,"cdraw",p,c/20*this.be.io_spacing,u/20*this.be.io_spacing)),t=t.substring(e[0].length);""!=t&&(e=a.exec(t));)n.push({o_cell:this.all_cells.length-1,o_port:e[1],i_cell:Number(e[2]),i_port:e[3]}),t=t.substring(e[0].length)}else{if(!(e=r.exec(t)))throw"not recognized: "+t;n.push({o_cell:Number(e[1]),o_port:e[2],i_cell:Number(e[3]),i_port:e[4]}),t=t.substring(e[0].length)}for(var _=0;_<n.length;_++){var b=n[_];if(b.o_cell>=this.all_cells.length)throw"bad o_cell #: "+b.o_cell;if(b.i_cell>=this.all_cells.length)throw"bad i_cell #: "+b.i_cell;var v=this.all_cells[b.o_cell],f=this.all_cells[b.i_cell],y=v.io[b.o_port],g=f.io[b.i_port];if(!y)throw"bad o port: "+b.o_port;if(!g)throw"bad i port: "+b.i_port;if(g.w.length>0){if(g.w[0].o!=y)throw"input port busy: "+b.i_port}else new o(this.be,y,g)}}catch(w){}},r.prototype.click_play=function(){this.row_allows_simple_click=!1,this.update_hover()},r.prototype.start=function(){for(var t in this.named_cells)"output"==this.named_cells[t].type&&this.named_cells[t].check_pending()},r.prototype.circuit_changed=function(){if(!this.cleaning_up){this.row_allows_simple_click=!1,this.select_seq(this.cur_seq),this.update_hover();for(var t=0;t<this.row_result.length;t++)this.record_result(t,void 0);this.be.sim.start()}},r.prototype.done=function(t){var e=!0;for(var i in this.named_cells)if("output"==this.named_cells[i].type){var s=this.named_cells[i].done_check();e=e&&s}if(this.record_result(this.cur_row(),e),e){if(this.cur_line<this.level.truth[this.cur_seq].length-1)return this.be.sim.pass_row($.proxy(this.next_line,this),t,"line"),void(this.be.sim.paused()&&(this.row_allows_simple_click=this.cur_row()+1,this.update_hover()));for(var o=null,h=0;h<this.row_result.length;h++){var a=this.row_seq[h];!this.row_result[h]&&(null===o||o<this.cur_seq&&a>=this.cur_seq)&&(o=a)}if(null!==o)return void this.be.sim.pass_row($.proxy(this.select_seq,this,o),t,"seq");this.be.sim.click_pause(),this.level.completed=!0;try{var r="boole."+this.level.name+".completed";localStorage.setItem(r,"true")}catch(n){}this.mark_complete(this.level_num);var l=this.level.outro||"",c=this.next_level(this.level_num+1);if(this.ui_only)if(c){var p=l+'<p><button type="button" id="next-puzzle">Next interface lesson</button></p>';this.be.div_infotxt.html(p),$("#next-puzzle").click($.proxy(this.change_level,this,c))}else{var p=l+'<p>You\'ve completed all of the interface lessons.  Are you ready for some puzzles? <button type="button" id="next-main">Main menu</button></p>';this.be.div_infotxt.html(p),$("#next-main").click($.proxy(this.click_main,this))}else if(c){var p=l+'<p><button type="button" id="next-puzzle">Next puzzle</button></p>';this.be.div_infotxt.html(p),$("#next-puzzle").click($.proxy(this.change_level,this,c))}else{var p=l+'<p>Congratulations!  You\'ve completed the last puzzle! <button type="button" id="next-main">Main menu</button></p>';this.be.div_infotxt.html(p),$("#next-main").click($.proxy(this.click_main,this))}smartquotes(this.be.div_infotxt[0]),this.be.circuit.resize(!1),this.be.circuit.update_view()}},r.prototype.change_level=function(t){this.cleaning_up=!0;for(var e=0;e<this.all_cells.length;e++)this.all_cells[e].remove();this.be.sim.click_pause(),this.be.sim.reset();for(var e=0;e<this.box_cells.length;e++)this.box_cells[e].remove();this.cleaning_up=!1,this.be.circuit.begin_level(t)},r.prototype.record_result=function(t,e){this.row_result[t]=e;var i="#check"+t;void 0===e?$(i).html(""):e?$(i).html('<path d="M7.5,16.5l6,12l12,-24" class="checkmark"/>'):$(i).html('<path d="M4.5,4.5l24,24m0,-24l-24,24" class="xmark"/>')},r.prototype.click_main=function(){this.be.sim.click_pause(),$("#level"+this.level_num).css({"background-color":"#ff8"}),$("#main_container").css({display:"block"}),this.ui_only=!0,void 0===this.next_level(0)&&$("#uilevels").remove(),this.ui_only=!1},r.prototype.click_level=function(t,e){$("#main_container").css({display:"none"}),$("#level"+this.level_num).css({"background-color":""}),t!==this.level_num&&this.change_level(t)},r.prototype.click_uilevels=function(t){this.ui_only=!0,this.click_level(this.next_level(0),t)},r.prototype.next_level=function(t){for(var e=t;e<this.puzzle.length;e++)if((this.puzzle[e].ui||!this.ui_only)&&!this.puzzle[e].completed)return e};var l=void 0;r.prototype.puzzle=[{name:"Press play",section:"Introduction to circuits",ui:!0,intro:'<p>&#9733; <b>Press the "play" button below</b> to transmit the electrical value from the stimulus pin "A" to the test pin "Z". &#9733;</p>',outro:"<p>Congratulations!</p>",truth:[{a:1,z:1}],hide:["truth","speed"],avail:[],cells:{a:{type:"input",x:100,y:100,io:[["o","z","i"]]},z:{type:"output",x:300,y:100}}},{name:"Draw a wire",ui:!0,intro:'<p>Now, you do it! <b>Draw a wire to connect A to Z.</b></p><p>Tip to draw a wire: While the mouse is over the stub at the right side of A, press and hold the mouse button, then move the mouse to the stub at the left side of Z before releasing the mouse button.</p><p>Tip: Press "play" to verify that your circuit is correct.</p>',outro:"<p>You can also draw a wire in the other direction. The direction that data flows on the wire is determined by what it's connected to.</p>",truth:[{a:1,z:1}],hide:["truth","speed"],avail:[],cells:{a:{type:"input",x:100,y:100},z:{type:"output",x:300,y:100}}},{name:"The truth table",ui:!0,intro:'<p>A circuit must typically pass multiple tests to prove that it is correct. <b>The truth table on the left shows what values are required</b> at the test pins for each set of values on the stimulus pins.</p><p>Clicking "play" causes each row of the truth table to be tested until every row has passed or until some row has failed.</p>',outro:"<p>Every row of the truth table must pass with a check mark in order to move on to the next puzzle.</p>",truth:[{a:0,z:0},{a:1,z:1}],hide:["speed"],avail:[],cells:{a:{type:"input",x:100,y:100,io:[["o","z","i"]]},z:{type:"output",x:300,y:100}}},{name:"The NOT gate",intro:"<p><b>A NOT gate changes a 0 to 1, or changes a 1 to a 0.</b>  In other words, the output of a NOT gate is 1 only if the input is <i>not</i> 1.</p>",outro:"<p>A NOT gate is also often called an inverter.</p>",truth:[{a:0,z:1},{a:1,z:0}],hide:["speed"],avail:[],cells:{a:{type:"input",x:100,y:100,io:[["o","inv","i"]]},inv:{type:"inv",x:250,y:100,io:[["o","z","i"]]},z:{type:"output",x:400,y:100}}},{name:"Create a gate",ui:!0,intro:"<p><b>Drag the NOT gate from the box at the left into the drawing area. Wire it so that data flows from A, through the NOT gate, to Z.</b></p><p>Tip to drag the NOT gate: While the mouse is over the NOT gate, press and hold the mouse button, then move the mouse into the drawing area near the stimulus and test pins before releasing the mouse button.</p><p>Tip: Simply touching two wire stubs is not sufficient to transmit a value between them. A wire must be drawn from one to the other.</p>",outro:"<p>Whatever is in the drawing area at the start of the puzzle is locked in place. But you can always freely move or delete any gates that you draw.</p>",truth:[{a:0,z:1},{a:1,z:0}],hide:["speed"],avail:["inv",1],cells:{a:{type:"input",x:100,y:100},z:{type:"output",x:400,y:100}}},{name:"Simulation controls",ui:!0,intro:'<p><b>Here are some new ways to control the simulation.</b></p><p>The small buttons next to the "play" button tell the simulation to pause when the propagating values have reached a gate <span class="nowrap">(<svg style="vertical-align:middle" width="1.2857em" height="1em" viewBox="-4 -2 18 14" fill="none"><rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/><path d="M0,0v10h5a5,5,0,0,0,0,-10h-5z" stroke="#888" stroke-width="1.5"/><path d="M-2.5,2.5H0M-2.5,7.5H0M12.5,5H10" stroke="#888" stroke-width="1"/></svg>)</span>, when one truth table line has passed testing <span class="nowrap">(<svg style="vertical-align:middle" width="1em" height="1em" viewBox="-2 -2 14 14" fill="none"><rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/><path d="M1.25,5l2.5,5l5,-10" stroke="#888" stroke-width="1.5"/></svg>),</span> or when all truth table rows have passed <span class="nowrap">(<svg style="vertical-align:middle" width="1em" height="1em" viewBox="-2 -2 14 14" fill="none"><rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/><path d="M0.25,2.5l1.25,2.5l2.5,-5M0.25,7.5l1.25,2.5l2.5,-5M5.5,2.5l1.25,2.5l2.5,-5M5.5,7.5l1.25,2.5l2.5,-5" stroke="#888" stroke-width="1"/></svg>).</span></p><p>You can switch to testing a different truth table row by clicking on that row. Double clicking a row selects it and immediately starts simulation (as if you clicked "play"). If simulation is paused immediately after one truth table row has passed, clicking "play" automatically advances to the next row.</p><p>The "speed" slider adjusts the speed of data flow from slow to fast.</p>',outro:'<p>The small buttons next to the "play" button tell the simulation to pause when the values have reached a gate, when one truth table row has passed testing, or when all truth table rows have passed.</p><p>You can switch to testing a different truth table row by clicking on that row. Double clicking a row selects it and immediately starts simulation (as if you clicked "play"). If simulation is paused immediately after one truth table row has passed, clicking "play" automatically advances to the next row.</p><p>The "speed" slider adjusts the speed of data flow from slow to fast.</p>',truth:[{a:0,z:0},{a:1,z:1}],avail:[],cells:{a:{type:"input",x:100,y:100,io:[["o","ia","i"]]},ia:{type:"inv",x:600,y:100,io:[["o","i0","i"]]},i0:{type:"inv",x:100,y:200,io:[["o","i1","i"]]},i1:{type:"inv",x:600,y:200,io:[["o","i2","i"]]},i2:{type:"inv",x:100,y:300,io:[["o","i3","i"]]},i3:{type:"inv",x:600,y:300,io:[["o","i4","i"]]},i4:{type:"inv",x:100,y:400,io:[["o","i5","i"]]},i5:{type:"inv",x:600,y:400,io:[["o","i6","i"]]},i6:{type:"inv",x:100,y:500,io:[["o","i7","i"]]},i7:{type:"inv",x:600,y:500,io:[["o","i8","i"]]},i8:{type:"inv",
x:100,y:600,io:[["o","z","i"]]},z:{type:"output",x:600,y:600}}},{name:"Wire fanout",ui:!0,intro:"<p><b>Add a wire to connect A to Z and another wire to connect A to Y.</b></p><p>Tip: The stub on the right side of the stimulus pin is an output port, which can be connected to the input ports on the left sides of both test pins.</p><p>Tip: A wire cannot connect from an input directly to another input. If you drag from Z to Y, it will move the existing wire (if any), or it will fail.",outro:'<p>As many wires as you want can "fan out" from any output port.</p>',truth:[{a:0,z:0,y:0},{a:1,z:1,y:1}],avail:[],cells:{a:{type:"input",x:100,y:100},z:{type:"output",x:300,y:100},y:{type:"output",x:300,y:200}}},{name:"A simple circuit",intro:"<p><b>Check the truth table</b> to see how this circuit should be connected.</p><p>Tip: The table says that when A is 1, Z must get a 1 value, and Y must get 0. It also says what values must go to the test pins when A is 0.</p>",outro:"<p>It looks like you're getting the hang of it!</p>",truth:[{a:1,z:1,y:0},{a:0,z:0,y:1}],avail:["inv",1],cells:{a:{type:"input",x:100,y:100},z:{type:"output",x:400,y:100},y:{type:"output",x:400,y:200}}},{name:"The AND gate",intro:"<p><b>An AND gate outputs a 1 only if its first input is 1 <i>and</i> its second input is 1.</b> Otherwise the output of the AND gate is 0.</p>",outro:"<p>When one of an AND gate's inputs is 1, then the value of the other input is propagated to the output of the gate. Otherwise, the gate output is 0.</p><p><b>Make sure you clearly understand the relationship of the AND gate's output with its inputs</b>, as displayed in the truth table. You will soon learn five other simple logic gates, each of which perform a different logic function.</p>",truth:[{a:0,b:0,z:0},{a:0,b:1,z:0},{a:1,b:0,z:0},{a:1,b:1,z:1}],avail:["and",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100}}},{name:"The NAND gate",intro:'<p><b>A NAND gate outputs an inverted value as compared to an AND gate.</b></p><p>Be careful when speaking aloud: "a NAND gate" is not "an AND gate".</p>',outro:"<p>As you'll soon see, NAND gates can be combined to implement every possible Boolean logic expression.</p>",truth:[{a:0,b:0,z:1},{a:0,b:1,z:1},{a:1,b:0,z:1},{a:1,b:1,z:0}],avail:["nand",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100}}},{name:"NAND is NOT-AND",intro:"<p><b>A NAND gate can be decomposed into an AND gate followed by an NOT gate.</b> The result is NOT 1 only if the AND gate's output is 1. In other words, it performs a NOT-AND function, also known as NAND.</p>",outro:"<p>Because a NAND gate combines the functions of an AND gate and an NOT gate, it combines the shape of the AND gate with the bubble from the NOT gate.</p>",truth:[{a:0,b:0,z:1},{a:0,b:1,z:1},{a:1,b:0,z:1},{a:1,b:1,z:0}],avail:["inv",1,"and",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100}}},{name:"NOT with NAND",intro:"<p>By tying its inputs to the same source, <b>a NAND gate can perform the same function as a NOT gate.</b></p>",outro:"<p>NAND gates are particularly small and fast in modern silicon circuits, so it is convenient that they are also so versatile.</p>",truth:[{a:0,z:1},{a:1,z:0}],avail:["nand",1],cells:{a:{type:"input",x:100,y:100},z:{type:"output",x:400,y:100}}},{name:"The OR gate",intro:"<p><b>An OR gate outputs a 1 if its first input is 1 <i>or</i> its second input is 1</b> (or both are 1). Otherwise the output of the OR gate is 0.</p>",outro:'<p>When one of an OR gate\'s inputs is 0, then the value of the other input is propagated to the output of the gate. Otherwise, the gate output is 1.</p><p>An OR gate is more precisely described with the legal term "and/or" because its output is 1 if its first input is 1 <i>and/or</i> its second input is 1.</p>',truth:[{a:0,b:0,z:0},{a:0,b:1,z:1},{a:1,b:0,z:1},{a:1,b:1,z:1}],avail:["or",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100}}},{name:"The NOR gate",intro:"<p><b>A NOR gate outputs an inverted value as compared to an OR gate.</b></p><p>In this puzzle we introduce the concept of a \"don't care\" value. If A is 1, we know that the output of the NOR gate must always be 0, so we <i>don't care</i> what B is. Likewise, we <i>don't care</i> what A is when B is 1.</p>",outro:'<p>This circuit simulator uses a black color to represent a value that is unknown, which includes "don\'t care" values. If a logic gate has an unknown input, a logic gate may output a known or unknown value depending on its input(s) and its logic function.</p>',truth:[{a:0,b:0,z:1},{a:l,b:1,z:0},{a:1,b:l,z:0}],avail:["nor",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100}}},{name:"The XOR and XNOR gates",intro:'<p>An XOR gate performs an "exclusive or" function. <b>An XOR gate outputs a 1 if its first input is <i>exclusively</i>&nbsp;1 <i>or</i> its second input is <i>exclusively</i>&nbsp;1.</b> Unlike an OR gate, an XOR gate outputs 0 if both of its inputs are 1.</p><p><b>An XNOR gate outputs an inverted value as compared to an XOR gate.</b></p>',outro:"<p>When one of an XOR gate's inputs is 0, then the value of the other input is propagated to the output of the gate. Otherwise, the value of the other input is inverted at the output.</p><p>There are no \"don't care\" cases for the XOR and XNOR gates.</p>",truth:[{a:0,b:0,z:0,y:1},{a:0,b:1,z:1,y:0},{a:1,b:0,z:1,y:0},{a:1,b:1,z:0,y:1}],avail:["xor",1,"xnor",1],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},z:{type:"output",x:400,y:100},y:{type:"output",x:400,y:200}}},{name:"Build a mux",section:"Easy combinational circuits",intro:"<p><b>Build a circuit that outputs either A or B, depending on the value of S.</b></p><p>Tip: If one input of an AND gate is 1, then the output of the AND gate equals its other input.</p>",outro:"<p>Now you're building real circuits!</p>",truth:[{s:0,a:0,z:0},{s:0,a:1,z:1},{s:1,b:0,z:0},{s:1,b:1,z:1}],avail:["inv","and","nand","or","nor","xor","xnor"],cells:{s:{type:"input",x:100,y:100},a:{type:"input",x:100,y:200},b:{type:"input",x:100,y:300},z:{type:"output",x:600,y:200}}},{name:"Detect odd",intro:"<p><b>Determine whether an odd number of stimulus pins have a 1 value.</b></p><p>Tip: Start with a circuit that works when&nbsp;C is 0, then add logic to handle the cases when C is 1.</p>",outro:"<p>Notice that it doesn't matter what order you put the XOR gates in. The result is always the same.</p>",truth:[{a:0,b:0,c:0,z:0},{a:1,b:0,c:0,z:1},{a:0,b:1,c:0,z:1},{a:1,b:1,c:0,z:0},{a:0,b:0,c:1,z:1},{a:1,b:0,c:1,z:0},{a:0,b:1,c:1,z:0},{a:1,b:1,c:1,z:1}],avail:["xor"],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},c:{type:"input",x:100,y:300},z:{type:"output",x:600,y:200}}},{name:"Detect >= 2",intro:"<p><b>Determine whether at least two stimulus pins have a 1 value.</b></p>",outro:"<p>The solutions to this puzzle and the previous one together comprise a <i>full adder</i>.</p>",truth:[{a:0,b:0,c:0,z:0},{a:1,b:0,c:0,z:0},{a:0,b:1,c:0,z:0},{a:1,b:1,c:0,z:1},{a:0,b:0,c:1,z:0},{a:1,b:0,c:1,z:1},{a:0,b:1,c:1,z:1},{a:1,b:1,c:1,z:1}],cells:{a:{type:"input",x:100,y:100},b:{type:"input",x:100,y:200},c:{type:"input",x:100,y:300},z:{type:"output",x:600,y:250}}},{name:"Seven-segment decode",section:"Advanced combinational circuits",intro:"<p><b>Decode each decimal value&nbsp;(0-9) to drive a seven-segment display.</b></p>",outro:"",truth:[{a3:0,a2:0,a1:0,a0:0,t:1,tl:1,tr:1,c:0,bl:1,br:1,b:1},{a3:0,a2:0,a1:0,a0:1,t:0,tl:0,tr:1,c:0,bl:0,br:1,b:0},{a3:0,a2:0,a1:1,a0:0,t:1,tl:0,tr:1,c:1,bl:1,br:0,b:1},{a3:0,a2:0,a1:1,a0:1,t:1,tl:0,tr:1,c:1,bl:0,br:1,b:1},{a3:0,a2:1,a1:0,a0:0,t:0,tl:1,tr:1,c:1,bl:0,br:1,b:0},{a3:0,a2:1,a1:0,a0:1,t:1,tl:1,tr:0,c:1,bl:0,br:1,b:1},{a3:0,a2:1,a1:1,a0:0,t:1,tl:1,tr:0,c:1,bl:1,br:1,b:1},{a3:0,a2:1,a1:1,a0:1,t:1,tl:0,tr:1,c:0,bl:0,br:1,b:0},{a3:1,a2:0,a1:0,a0:0,t:1,tl:1,tr:1,c:1,bl:1,br:1,b:1},{a3:1,a2:0,a1:0,a0:1,t:1,tl:1,tr:1,c:1,bl:0,br:1,b:1}],cells:{a3:{type:"input",x:0,y:0},a2:{type:"input",x:0,y:100},a1:{type:"input",x:0,y:200},a0:{type:"input",x:0,y:300},t:{type:"output",x:875,y:0},tl:{type:"output",x:800,y:75},tr:{type:"output",x:950,y:75},c:{type:"output",x:875,y:150},bl:{type:"output",x:800,y:225},br:{type:"output",x:950,y:225},b:{type:"output",x:875,y:300}}},{name:"Seven-segment encode",intro:"<p><b>Recognize the value on a seven-segment display and encode it as a decimal value&nbsp;(0-9).</b></p>",outro:"",truth:[{t:1,tl:1,tr:1,c:0,bl:1,br:1,b:1,z3:0,z2:0,z1:0,z0:0},{t:0,tl:0,tr:1,c:0,bl:0,br:1,b:0,z3:0,z2:0,z1:0,z0:1},{t:1,tl:0,tr:1,c:1,bl:1,br:0,b:1,z3:0,z2:0,z1:1,z0:0},{t:1,tl:0,tr:1,c:1,bl:0,br:1,b:1,z3:0,z2:0,z1:1,z0:1},{t:0,tl:1,tr:1,c:1,bl:0,br:1,b:0,z3:0,z2:1,z1:0,z0:0},{t:1,tl:1,tr:0,c:1,bl:0,br:1,b:1,z3:0,z2:1,z1:0,z0:1},{t:1,tl:1,tr:0,c:1,bl:1,br:1,b:1,z3:0,z2:1,z1:1,z0:0},{t:1,tl:0,tr:1,c:0,bl:0,br:1,b:0,z3:0,z2:1,z1:1,z0:1},{t:1,tl:1,tr:1,c:1,bl:1,br:1,b:1,z3:1,z2:0,z1:0,z0:0},{t:1,tl:1,tr:1,c:1,bl:0,br:1,b:1,z3:1,z2:0,z1:0,z0:1}],cells:{t:{type:"input",x:75,y:0},tl:{type:"input",x:0,y:75},tr:{type:"input",x:150,y:75},c:{type:"input",x:75,y:150},bl:{type:"input",x:0,y:225},br:{type:"input",x:150,y:225},b:{type:"input",x:75,y:300},z3:{type:"output",x:1e3,y:0},z2:{type:"output",x:1e3,y:100},z1:{type:"output",x:1e3,y:200},z0:{type:"output",x:1e3,y:300}}},{name:"The D latch",section:"Introduction to latches",intro:"<p>A <i>D latch</i> is our first storage element. It passes its D (data) input to its Q output when its E (enable) input is 1, but it holds its Q output constant when E is 0. The latch is described as <i>transparent</i> when data is allowed to pass through it and <i>opaque</i> when its output is held constant.</p><p>In order to test a circuit with storage elements, each boxed section of the truth table contains multiple lines. Each line represents one step of a test sequence. Clicking in the truth table starts a fresh test sequence for the selected row.</p>",outro:'<p>Simulation can be automatically paused when one line of a test sequence has passed <span class="nowrap">(<svg style="vertical-align:middle" width="1em" height="1em" viewBox="-2 -2 14 14" fill="none"><path d="M1.25,5l2.5,5l5,-10" stroke="#888" stroke-width="1.5"/></svg>)</span> or when all lines of a test sequence have passed <span class="nowrap">(<svg style="vertical-align:middle" width="1em" height="1em" viewBox="-2 -2 14 14" fill="none"><path d="M3,2.5l1.25,2.5l2.5,-5M3,7.5l1.25,2.5l2.5,-5" stroke="#888" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/></svg>).</span></p>',truth:[[{e:1,d:0,q:0},{e:1,d:1,q:1},{e:0,d:1,q:1},{e:0,d:0,q:1}],[{e:1,d:1,q:1},{e:1,d:0,q:0},{e:0,d:0,q:0},{e:0,d:1,q:0}]],cells:{e:{type:"input",x:100,y:100,io:[["o","latch","e"]]},d:{type:"input",x:100,y:200,io:[["o","latch","d"]]},latch:{type:"latch",x:380,y:120,io:[["q","q","i"]]},q:{type:"output",x:500,y:100}}},{name:"An SR latch",intro:"<p>A D latch is typically built with an <i>SR latch</i> inside, as shown in the circuit below. It can be <i>set</i> to 1 or <i>reset</i> to 0 by its inputs. If it is currently neither set nor reset, then it holds its last value by recirculating that value infinitely.</p><p><b>Connect the S pin so that it sets the latch to 1 and the R pin so that it resets the latch to 0.</b></p>",outro:"<p>What happens if S and R are both 1?</p>",truth:[[{s:1,r:0,q:1},{s:0,r:0,q:1},{s:0,r:1,q:0},{s:0,r:0,q:0}]],cells:{s:{type:"input",x:100,y:100},r:{type:"input",x:100,y:200},q:{type:"output",x:600,y:100},and:{type:"and",x:480,y:100,io:[["o","q","i"],["o","or","i0"]]},or:{type:"or",x:360,y:90,io:[["o","and","i0"]]}}},{name:"Build a D latch",intro:"<p>The logic that feeds the SR latch can be built up to implement the D latch. Because NAND gates are generally easier to implement using silicon transistors, a more common SR latch design uses a pair of NAND gates to recirculate the data. This latch design has the convenient property that the latch output is available in both regular and inverted forms.</p><p><b>Connect the latch so that it is transparent and propagates the D value only when E is 1.</b> Once the latch output is initialized, ~Q must be the inverted value of Q.</p>",outro:"<p>The circuit you designed is called a D latch.</p>",truth:[[{e:0,d:0,q:l,"~q":l},{e:1,d:0,q:0,"~q":1},{e:1,d:1,q:1,"~q":0},{e:0,d:1,q:1,"~q":0},{e:0,d:0,q:1,"~q":0}],[{e:0,d:1,q:l,"~q":l},{e:1,d:1,q:1,"~q":0},{e:1,d:0,q:0,"~q":1},{e:0,d:0,q:0,"~q":1},{e:0,d:1,q:0,"~q":1}]],cells:{e:{type:"input",x:100,y:100},d:{type:"input",x:100,y:200},q:{type:"output",x:600,y:100},"~q":{type:"output",x:600,y:200},nand1:{type:"nand",x:480,y:100,io:[["o","q","i"],["o","nand2","i0"]]},nand2:{type:"nand",x:480,y:200,io:[["o","~q","i"],["o","nand1","i1"]]}}},{name:"Metastability",intro:"<p>If a latch becomes opaque at the same moment that its data input changes value, the latch may be caught between accepting and rejecting the new data value. To prevent this uncertainty, the logic preceding the latch will typically <i>set up</i> a new data value for at least a minimum amount of time before the latch becomes opaque, and it will also <i>hold</i> the data value for a minimum amount of time after the latch becomes opaque.</p><p>The circuit below does not meet the minimum set-up and hold times. As a result, when D changes value at the same time as E becomes 0, the output of the latch depends on the speed of the wires. <b>Adjust the simulation speed using the speed slider in order to ensure that the latch becomes opaque without capturing the new D value.</b></p><p>Tip: You may need to click in the truth table to restart a test sequence with a new speed.</p>",outro:"<p>You may have noticed that at the default speed (the middle tick mark on the speed slider), the latch becomes opaque with two different values inside it. When this occurs, the latch isn't stable at a particular value, but instead is <i>metastable</i> while the different values chase each other through the latch's recirculating gates.</p>",truth:[[{e:1,d:0,q:0},{e:0,d:1,q:0}],[{e:1,d:1,q:1},{e:0,d:0,q:1}]],avail:[],cells:{e:{type:"input",x:-210,y:130,io:[["o","nand3","i0"],["o","nand4","i0"]]},d:{type:"input",x:200,y:145,io:[["o","nand3","i1"],["o","inv","i"]]},q:{type:"output",x:600,y:100},nand1:{type:"nand",x:480,y:100,io:[["o","q","i"],["o","nand2","i0"]]},nand2:{type:"nand",x:480,y:190,io:[["o","nand1","i1"]]},nand3:{type:"nand",x:360,y:90,io:[["o","nand1","i0"]]},nand4:{type:"nand",x:360,y:200,io:[["o","nand2","i1"]]},inv:{type:"inv",x:285,y:210,io:[["o","nand4","i1"]]}}},{name:"Meeting hold requirement",intro:"<p>This circuit uses a pre-built D latch cell. <b>Connect the E and D pins in such a way that the new D value is not captured if it changes at the same time as E changes to 0.</b></p><p>Tip: Make sure that the D value meets the hold time requirement.</p>",outro:"<p>Does your solution work for all simulation speeds?</p>",truth:[[{e:1,d:0,q:0},{e:1,d:1,q:1},{e:0,d:0,q:1},{e:0,d:1,q:1}],[{e:1,d:1,q:1},{e:1,d:0,q:0},{e:0,d:1,q:0},{e:0,d:0,q:0}]],cells:{e:{type:"input",x:100,y:100,io:[["o","inv1","i"]]},d:{type:"input",x:100,y:200},inv1:{type:"inv",x:225,y:0,io:[["o","inv2","i"]]},inv2:{type:"inv",x:325,y:0,io:[["o","latch","e"]]},latch:{type:"latch",x:450,y:120,io:[["q","q","i"]]},q:{type:"output",x:600,y:100}}},{name:"Meeting set-up requirement",intro:"<p>This circuit uses a pre-built D latch cell. <b>Connect the E and D pins in such a way that the new D value is captured if it changes at the same time as E changes to 0.</b></p><p>Tip: Make sure that the D value meets the set-up time requirement.</p>",outro:"<p>Does your solution work for all simulation speeds?</p>",truth:[[{e:1,d:0,q:0},{e:1,d:1,q:1},{e:0,d:0,q:0},{e:0,d:1,q:0}],[{e:1,d:1,q:1},{e:1,d:0,q:0},{e:0,d:1,q:1},{e:0,d:0,q:1}]],cells:{e:{type:"input",x:100,y:100},d:{type:"input",x:100,y:200,io:[["o","inv1","i"]]},inv1:{type:"inv",x:225,y:300,io:[["o","inv2","i"]]},inv2:{type:"inv",x:325,y:300,io:[["o","latch","d"]]},latch:{type:"latch",x:450,y:120,io:[["q","q","i"]]},q:{type:"output",x:600,y:100}}},{name:"Entrance bell",section:"Latch-based circuits",intro:"<p>A store owner has a pair of electric eyes at the front of her store that each output a 1 when the light path is uninterrupted and a 0 when the beam is broken. The eyes are arranged so that a person entering the store blocks only the first eye's beam, then both beams, then only the second eye's beam. <b>Design a circuit that rings a bell when both beams are broken as a person enters, but not as a person leaves.</b></p>",outro:"<p>Ding!</p>",hint:["<p>Knowing that both beams are broken is not enough information to determine the direction of travel. A storage element is needed to remember which beam was previously broken.</p>","<p>A D latch holds its previous input value when its enable goes to 0.</p>"],soln:"1s3-0,o,3,d-0,o,5,i0-1,o,3,e-1,o,4,i1;250,latch,150+q,4,i0;380,or,190+o,5,i1;480,nor,100+o,2,i",truth:[[{b1:1,b2:1,z:0},{b1:0,b2:1,z:0},{b1:0,b2:0,z:1},{b1:1,b2:0,z:0},{b1:1,b2:1,z:0}],[{b1:1,b2:1,z:0},{b1:1,b2:0,z:0},{b1:0,b2:0,z:0},{b1:0,b2:1,z:0},{b1:1,b2:1,z:0}]],avail:["latch","inv","and","nand","or","nor","xor","xnor"],cells:{b1:{type:"input",x:100,y:100},b2:{type:"input",x:100,y:200},z:{type:"output",x:600,y:100}}},{name:"Build a D flip-flop",intro:"<p>Sequential circuits are typically built around an oscillating clock signal. The clock cannot simply be used as the enable to a D latch because doing so would allow values to propagate all the way through the circuit while the clock is high.</p><p><b>Design a circuit that transmits the D input to the Q output only as the CLK signal transitions from 0 to 1.</b></p>",outro:"<p>This circuit is called a D flip-flop. If you used a chained pair of latches, it is a master-slave D flip-flop.</p>",hint:["<p>If you use a latch as the storage element, the input to the latch needs to be held constant while the latch is transparent.</p>","<p>Use two latches in series with opposite polarity enables.</p>","<p>Make sure that the first latch meets the hold time requirement of the second.</p>"],soln:"1s3-0,o,4,d-1,o,5,i-1,o,3,e;540,latch,200+q,2,i;380,latch,20+q,3,d;240,inv,140+o,4,e",truth:[[{d:0,clk:0,q:l},{d:0,clk:1,q:0},{d:1,clk:1,q:0},{d:1,clk:0,q:0},{d:0,clk:0,q:0},{d:1,clk:0,q:0},{d:1,clk:1,q:1},{d:0,clk:1,q:1},{d:0,clk:0,q:1},{d:1,clk:0,q:1},{d:0,clk:0,q:1},{d:0,clk:1,q:0}]],avail:["latch","inv","and","nand","or","nor","xor","xnor"],cells:{d:{type:"input",x:100,y:100},clk:{type:"input",x:100,y:200},q:{type:"output",x:700,y:100}}},{name:"Asynchronous reset",intro:"<p>A regular D flip-flop does not have a defined value until the first time that its clock signal goes from 0 to 1. To ensure predictable results, a circuit will typically include a reset signal to initialize its flip-flop values.</p><p><b>Build a D flip-flop that includes a reset signal that forces its output to 0 regardless of the state of its clock signal.</b> After the reset signal is cleared, ensure that the output 0 value is held until the next rising clock edge.</p>",outro:"<p>This type of reset is an asynchronous reset. If the output were only cleared at the rising edge of the clock, it would be a synchronous reset.</p>",truth:[[{d:0,clk:0,r:1,q:0},{d:0,clk:1,r:1,q:0},{d:1,clk:1,r:1,q:0},{d:1,clk:0,r:1,q:0},{d:1,clk:0,r:0,q:0},{d:1,clk:1,r:0,q:1},{d:0,clk:1,r:0,q:1}],[{d:1,clk:0,r:1,q:0},{d:1,clk:1,r:1,q:0},{d:0,clk:1,r:1,q:0},{d:0,clk:0,r:1,q:0},{d:0,clk:0,r:0,q:0},{d:0,clk:1,r:0,q:0},{d:1,clk:1,r:0,q:0}],[{d:1,clk:0,r:1,q:0},{d:1,clk:1,r:1,q:0},{d:1,clk:1,r:0,q:0}],[{d:0,clk:0,r:1,q:0},{d:0,clk:1,r:1,q:0},{d:0,clk:1,r:0,q:0}],[{d:1,clk:0,r:1,q:0},{d:1,clk:0,r:0,q:0}],[{d:1,clk:1,r:1,q:0},{d:1,clk:1,r:0,q:0}]],avail:["latch","inv","and","nand","or","nor","xor","xnor"],cells:{d:{type:"input",x:100,y:100},clk:{type:"input",x:100,y:200},r:{type:"input",x:100,y:300},q:{type:"output",x:700,y:100}}}],n.prototype.drag=function(t,e,i,s,o){var h={jel:t,context:e,type:i,callbacks:s,extra:o};t.on("mousedown.booletouch",$.proxy(this.mousedown,this,h)),t.on("touchstart.booletouch",$.proxy(this.touchstart,this,h))},n.prototype.undrag=function(t){t.off("mousedown.booletouch"),t.off("touchstart.booletouch")},n.prototype.mousedown=function(t,e){if((void 0===e.which||1==e.which)&&(e.preventDefault(),!this.dragging)){this.dragging="mouse",this.mousedata=t;var i=$(document);i.on("mousemove.booledrag",$.proxy(this.mousemove,this)),i.on("mouseup.booledrag",$.proxy(this.mouseup,this)),t.callbacks.start&&t.callbacks.start.call(t.context,e.pageX,e.pageY,t.extra)}},n.prototype.mousemove=function(t){this.mousedata.callbacks.move&&this.mousedata.callbacks.move.call(this.mousedata.context,t.pageX,t.pageY,this.mousedata.extra)},n.prototype.mouseup=function(t){this.dragging=!1;var e=$(document);e.off("mousemove.booledrag"),e.off("mouseup.booledrag"),this.mousedata.callbacks.end&&this.mousedata.callbacks.end.call(this.mousedata.context,this.mousedata.extra)},n.prototype.touchstart=function(t,e){var i=e.originalEvent||e;if((t.callbacks.start||t.callbacks.move||t.callbacks.end)&&("cbox"!=t.type&&e.preventDefault(),e.stopPropagation()),"mouse"!=this.dragging){if(t.callbacks.dblclick&&void 0!==i.timeStamp){var s=this.tapdata[t.type];if(void 0!==s&&s.jel==t.jel){var o=i.timeStamp-s.timeStamp;500>o&&o>0&&t.callbacks.dblclick.call(t.context,i.changedTouches[0].pageX,i.changedTouches[0].pageY,t.extra)}this.tapdata[t.type]={jel:t.jel,timeStamp:i.timeStamp}}if(t.callbacks.start||t.callbacks.move||t.callbacks.end)for(var h=0;h<i.changedTouches.length;h++){var a=i.changedTouches[h];if(t.callbacks.pinch_start&&this.touchdata[t.type]&&void 0===t.pinchid){t.pinchid=a.identifier;for(var r=0;r<i.touches.length;r++)i.touches[r].identifier==t.touchid&&t.callbacks.pinch_start.call(t.context,i.touches[r].pageX,i.touches[r].pageY,a.pageX,a.pageY,t.extra);break}if(this.touchdata[t.type])break;if(!this.dragging){var n=$(document);n.on("touchmove.booledrag",$.proxy(this.touchmove,this)),n.on("touchend.booledrag",$.proxy(this.touchmove,this)),n.on("touchcancel.booledrag",$.proxy(this.touchmove,this))}this.dragging="touch",t.touchid=a.identifier,t.pinchid=void 0,this.touchdata[t.type]=t,t.callbacks.start&&t.callbacks.start.call(t.context,a.pageX,a.pageY,t.extra)}}},n.prototype.touchmove=function(t){for(var e=t.originalEvent||t,i=["canvas","cbox","speed","truth","cell"],s=0;s<i.length;s++){var o=i[s],h=this.touchdata[o];if(h){for(var a=0;a<e.touches.length;a++)if(e.touches[a].identifier==h.touchid){if(h.callbacks.move){var r=e.touches[a].pageX,n=e.touches[a].pageY;h.callbacks.move.call(h.context,r,n,h.extra)}break}var l=a==e.touches.length,c=!1;if(void 0!==h.pinchid){for(var a=0;a<e.touches.length;a++)if(e.touches[a].identifier==h.pinchid){l?(l=!1,h.touchid=h.pinchid,h.pinchid=void 0,h.callbacks.end&&h.callbacks.end.call(h.context,h.extra),h.callbacks.start&&h.callbacks.start.call(h.context,e.touches[a].pageX,e.touches[a].pageY,h.extra)):h.callbacks.pinch_move.call(h.context,r,n,e.touches[a].pageX,e.touches[a].pageY);break}c=a==e.touches.length}l?(h.callbacks.end&&h.callbacks.end.call(h.context,h.extra),this.touchdata[o]=void 0):c&&(h.pinchid=void 0)}}if(!e.touches.length){this.dragging=!1;var p=$(document);p.off("touchmove.booledrag"),p.off("touchend.booledrag"),p.off("touchcancel.booledrag")}};</script>
</head>
<body>
  <div id="truth">
    <div id="truthtable">
    </div>
  </div>
  <div id="info-stub">
    <svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="button-info-unhide" class="infobutton">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<rect x="15" y="15" width="70" height="70" stroke="#888" stroke-width="3" fill="none"/>
	<path d="M45,70h25v-25M70,70L30,30" stroke="#888" stroke-width="7" stroke-linecap="round" fill="none"/>
      </g>
    </svg>
  </div>
  <div id="info">
    <svg style="float: right;" width="4em" height="2em" viewBox="0 0 200 100">
      <g id="button-info-hide" class="infobutton">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<path d="M30,45H15V15H45V30" stroke="#888" stroke-width="3" fill="none"/>
	<path d="M30,55v-25h25M30,30L80,80" stroke="#888" stroke-width="7" stroke-linecap="round" fill="none"/>
      </g>
      <g id="button-main" class="infobutton">
	<rect x="105" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<path d="M110,20h80M110,50h80M110,80h80" stroke="#888" stroke-width="16"/>
      </g>
    </svg>
    <span id="infotxt"><p>Boole&rsquo;s Errand</p><p>Copyright 2016 Christopher P. Nelson - All rights reserved.</p><p>Javascript is required to play.</p></span>
  </div>
  <div id="sim-controls" class="controls" style="padding-top: 1px;">
    <svg id="pause-at" width="2.5714em" height="2em" viewBox="-4 -2 36 28" stroke="#888">
      <g id="pause-at-gate" class="pause-at">
	<rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/>
	<path d="M0,0v10h5a5,5,0,0,0,0,-10h-5z" stroke-width="1.5" fill="none"/>
	<path d="M-2.5,2.5H0M-2.5,7.5H0M12.5,5H10" stroke-width="1"/>
      </g>
      <g id="pause-at-line" class="pause-at" transform="translate(18,0)">
	<rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/>
	<path d="M1.25,5l2.5,5l5,-10" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
      </g>
      <g id="pause-at-seq" class="pause-at" transform="translate(0,14)">
	<rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/>
	<path d="M3,2.5l1.25,2.5l2.5,-5M3,7.5l1.25,2.5l2.5,-5" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
      </g>
      <g id="pause-at-done" class="pause-at pause-at-selected" transform="translate(18,14)">
	<rect x="-4" y="-2" width="18" height="14" stroke-width="0" rx="3" ry="3"/>
	<path d="M0.25,2.5l1.25,2.5l2.5,-5M0.25,7.5l1.25,2.5l2.5,-5M5.5,2.5l1.25,2.5l2.5,-5M5.5,7.5l1.25,2.5l2.5,-5" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"/>
      </g>
    </svg>
    <svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="button-play">
	<rect x="10" y="10" width="80" height="80" rx="20" ry="20" class="playborder" />
	<path d="M37,25v50l30,-25z" class="playcenter" />
      </g>
      <g id="button-pause" style="display: none">
	<rect x="10" y="10" width="80" height="80" rx="20" ry="20" class="pauseborder" />
	<path d="M40,26v48M60,26v48" class="pausecenter" />
      </g>
    </svg>
    <svg id="speed-slider" width="3.5em" height="2em" viewBox="0 0 350 200" cursor="pointer">
      <defs>
	<linearGradient id="slidergrad">
	  <stop offset="3%" stop-color="#88d"/>
	  <stop offset="77%" stop-color="#6d6"/>
	</linearGradient>
      </defs>
      <text id="speed-text" x="175" y="85" text-anchor="middle" font-family="Verdana" font-size="60"; fill="#7ca6b3">Speed</text>
      <path d="M20,140H330m-30,-30l30,30l-30,30" stroke="url(#slidergrad)" stroke-width="10" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
      <path d="M30,130v20M110,130v20M260,130v20" stroke="#222" stroke-width="4" stroke-linecap="butt" fill="none" opacity="0.5"/>
      <circle id="speed-knob" cx="110" cy="140" r="30" stroke-width="0" fill="#888"/>
    </svg>
  </div>
  <div id="main-stub" class="controls" style="position: fixed; top: 0; right: 0;">
    <svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="button-main2" class="pause-at">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<path d="M10,20h80M10,50h80M10,80h80" stroke="#888" stroke-width="16"/>
      </g>
    </svg>
  </div>
  <div id="zoom-controls" class="controls" style="position: fixed; bottom: 0; right: 0;">
    <svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="zoom-in" class="pause-at">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<circle cx="37" cy="37" r="20" stroke="#888" stroke-width="7" fill="none"/>
	<path d="M37,30v14M30,37h14M52,52L83,83" stroke="#888" stroke-width="7" stroke-linecap="round" fill="none"/>
      </g>
    </svg><svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="zoom-out" class="pause-at">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<circle cx="37" cy="37" r="20" stroke="#888" stroke-width="7" fill="none"/>
	<path d="M30,37h14M52,52L83,83" stroke="#888" stroke-width="7" stroke-linecap="round" fill="none"/>
      </g>
    </svg><svg width="2em" height="2em" viewBox="0 0 100 100">
      <g id="zoom-fit" class="pause-at">
	<rect x="5" y="5" width="90" height="90" stroke-width="0" rx="8" ry="8"/>
	<rect x="15" y="15" width="70" height="70" stroke="#888" stroke-width="3" fill="none"/>
	<path d="M50,42V20M40,30L50,20L60,30M58,50H80M70,40L80,50L70,60M50,58V80M40,70L50,80L60,70M42,50H20M30,40L20,50L30,60" stroke="#888" stroke-width="5" stroke-linecap="round" fill="none"/>
      </g>
    </svg>
  </div>
  <div id="cbox_container">
    <div id="cbox">
    </div>
  </div>
  <div id="cdraw">
  </div>
  <div id="cdrag">
  </div>
  <div id="main_container">
    <div id="main_curtain">
    </div>
    <div id="main">
      <p style="text-align: center; font-size: 150%"><b>Boole&rsquo;s Errand</b></p>
      <p style="text-align: center">&copy; 2016 Chris Nelson</p>
      <div id="levels">
      </div>
    </div>
  </div>
</body></html>
